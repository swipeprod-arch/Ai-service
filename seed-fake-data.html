<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üé≤ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ñ–µ–π–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .container {
      background: white;
      border-radius: 20px;
      padding: 40px;
      max-width: 600px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    h1 {
      font-size: 32px;
      margin-bottom: 10px;
      color: #333;
    }
    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 16px;
    }
    .settings {
      background: #f5f5f5;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
    }
    .setting-row {
      margin-bottom: 15px;
    }
    .setting-row:last-child {
      margin-bottom: 0;
    }
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: #333;
      font-size: 14px;
    }
    input[type="number"],
    input[type="email"] {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s;
    }
    input[type="number"]:focus,
    input[type="email"]:focus {
      outline: none;
      border-color: #667eea;
    }
    button {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      margin-bottom: 15px;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
    }
    button:active {
      transform: translateY(0);
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    .log {
      background: #1a1a1a;
      color: #00ff00;
      padding: 20px;
      border-radius: 12px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      max-height: 400px;
      overflow-y: auto;
      line-height: 1.6;
      display: none;
    }
    .log.active {
      display: block;
    }
    .log-line {
      margin-bottom: 5px;
    }
    .log-success { color: #00ff00; }
    .log-error { color: #ff4444; }
    .log-info { color: #44aaff; }
    .log-warning { color: #ffaa00; }
    .progress {
      background: #f0f0f0;
      height: 30px;
      border-radius: 15px;
      overflow: hidden;
      margin-bottom: 15px;
      display: none;
    }
    .progress.active {
      display: block;
    }
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      transition: width 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 14px;
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }
    .stat-card {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
    }
    .stat-value {
      font-size: 24px;
      font-weight: 700;
      color: #667eea;
      margin-bottom: 5px;
    }
    .stat-label {
      font-size: 12px;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üé≤ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–∞–Ω–Ω—ã—Ö</h1>
    <p class="subtitle">–°–æ–∑–¥–∞–Ω–∏–µ —Ñ–µ–π–∫–æ–≤—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ —Å –º–µ–¥–∏–∞</p>

    <div class="settings">
      <div id="authBlock" class="setting-row" style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
        <label style="color: #856404;">üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!):</label>
        <input type="email" id="authEmail" placeholder="–í–≤–µ–¥–∏ —Å–≤–æ–π email" style="width: 100%; padding: 12px; border: 2px solid #ffc107; border-radius: 8px; margin-bottom: 10px;">
        <button onclick="sendAuthLink()" id="authBtn" style="width: 100%; background: #ffc107; color: #000; padding: 12px; margin-bottom: 0;">
          üìß –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –¥–ª—è –≤—Ö–æ–¥–∞
        </button>
        <div id="authStatus" style="margin-top: 10px; font-size: 14px; color: #856404;"></div>
      </div>
      
      <div id="settingsBlock" style="opacity: 0.5; pointer-events: none;">
        <div class="setting-row">
          <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ä—Ç–æ—á–µ–∫ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤:</label>
          <input type="number" id="expertsCount" value="100" min="1" max="1000">
        </div>
        <div class="setting-row">
          <label>–ê–ª—å–±–æ–º–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É (2-4):</label>
          <input type="number" id="albumsPerExpert" value="3" min="1" max="10">
        </div>
        <div class="setting-row">
          <label>–ú–µ–¥–∏–∞ –Ω–∞ –∞–ª—å–±–æ–º (3-7):</label>
          <input type="number" id="mediaPerAlbum" value="5" min="1" max="20">
        </div>
      </div>
    </div>

    <div class="stats">
      <div class="stat-card">
        <div class="stat-value" id="statExperts">0</div>
        <div class="stat-label">–≠–∫—Å–ø–µ—Ä—Ç—ã</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="statAlbums">0</div>
        <div class="stat-label">–ê–ª—å–±–æ–º—ã</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="statMedia">0</div>
        <div class="stat-label">–ú–µ–¥–∏–∞</div>
      </div>
    </div>

    <div class="progress" id="progress">
      <div class="progress-bar" id="progressBar">0%</div>
    </div>

    <button id="startBtn" onclick="startGeneration()">üöÄ –ù–∞—á–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é</button>
    <button id="clearBtn" onclick="clearAllData()" style="background: #dc3545;">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>

    <div class="log" id="log"></div>
  </div>

  <script>
    // ====== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø SUPABASE ======
    const SUPABASE_URL = "https://orxzpefskbkcyuoobkol.supabase.co";
    const SUPABASE_ANON_KEY = "sb_publishable_fj9X3SDLjXiL0v3pajtMwA_fTYhN3us";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // ====== –î–ê–ù–ù–´–ï –î–õ–Ø –ì–ï–ù–ï–†–ê–¶–ò–ò ======
    const CATEGORIES = ['design', 'video', 'photo', 'text', 'audio'];
    
    const ROLES = {
      design: ['UI/UX –î–∏–∑–∞–π–Ω–µ—Ä', '–ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –¥–∏–∑–∞–π–Ω–µ—Ä', '–í–µ–±-–¥–∏–∑–∞–π–Ω–µ—Ä', '–ú–æ—É—à–Ω-–¥–∏–∑–∞–π–Ω–µ—Ä', '–ü—Ä–æ–¥—É–∫—Ç–æ–≤—ã–π –¥–∏–∑–∞–π–Ω–µ—Ä'],
      video: ['–í–∏–¥–µ–æ–≥—Ä–∞—Ñ', '–í–∏–¥–µ–æ–º–æ–Ω—Ç–∞–∂–µ—Ä', '–ú–æ—É—à–Ω-–¥–∏–∑–∞–π–Ω–µ—Ä', '–û–ø–µ—Ä–∞—Ç–æ—Ä', '–†–µ–∂–∏—Å—Å–µ—Ä –º–æ–Ω—Ç–∞–∂–∞'],
      photo: ['–§–æ—Ç–æ–≥—Ä–∞—Ñ', '–†–µ—Ç—É—à–µ—Ä', '–§—É–¥-—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ', '–ü—Ä–µ–¥–º–µ—Ç–Ω—ã–π —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ', '–ü–æ—Ä—Ç—Ä–µ—Ç–∏—Å—Ç'],
      text: ['–ö–æ–ø–∏—Ä–∞–π—Ç–µ—Ä', '–†–µ–¥–∞–∫—Ç–æ—Ä', '–ö–æ–Ω—Ç–µ–Ω—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä', 'SMM-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç', '–°—Ü–µ–Ω–∞—Ä–∏—Å—Ç'],
      audio: ['–ó–≤—É–∫–æ—Ä–µ–∂–∏—Å—Å–µ—Ä', '–ö–æ–º–ø–æ–∑–∏—Ç–æ—Ä', '–î–∏–∫—Ç–æ—Ä', '–ü–æ–¥–∫–∞—Å—Ç–µ—Ä', '–ê—É–¥–∏–æ–∏–Ω–∂–µ–Ω–µ—Ä']
    };

    const NAMES = [
      '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä', '–ú–∞—Ä–∏—è', '–î–º–∏—Ç—Ä–∏–π', '–ê–Ω–Ω–∞', '–°–µ—Ä–≥–µ–π',
      '–ï–ª–µ–Ω–∞', '–ê–Ω–¥—Ä–µ–π', '–û–ª—å–≥–∞', '–ú–∏—Ö–∞–∏–ª', '–ù–∞—Ç–∞–ª—å—è',
      '–ò–≤–∞–Ω', '–¢–∞—Ç—å—è–Ω–∞', '–ê–ª–µ–∫—Å–µ–π', '–°–≤–µ—Ç–ª–∞–Ω–∞', '–í–ª–∞–¥–∏–º–∏—Ä',
      '–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞', '–ù–∏–∫–æ–ª–∞–π', '–ò—Ä–∏–Ω–∞', '–ü–∞–≤–µ–ª', '–Æ–ª–∏—è',
      '–†–æ–º–∞–Ω', '–í–∏–∫—Ç–æ—Ä–∏—è', '–ú–∞–∫—Å–∏–º', '–î–∞—Ä—å—è', '–ê—Ä—Ç–µ–º'
    ];

    const SURNAMES = [
      '–°–º–∏—Ä–Ω–æ–≤', '–ò–≤–∞–Ω–æ–≤', '–ö—É–∑–Ω–µ—Ü–æ–≤', '–ü–æ–ø–æ–≤', '–°–æ–∫–æ–ª–æ–≤',
      '–õ–µ–±–µ–¥–µ–≤', '–ö–æ–∑–ª–æ–≤', '–ù–æ–≤–∏–∫–æ–≤', '–ú–æ—Ä–æ–∑–æ–≤', '–ü–µ—Ç—Ä–æ–≤',
      '–í–æ–ª–∫–æ–≤', '–°–æ–ª–æ–≤—å–µ–≤', '–í–∞—Å–∏–ª—å–µ–≤', '–ó–∞–π—Ü–µ–≤', '–ü–∞–≤–ª–æ–≤',
      '–°–µ–º–µ–Ω–æ–≤', '–ì–æ–ª—É–±–µ–≤', '–í–∏–Ω–æ–≥—Ä–∞–¥–æ–≤', '–ë–æ–≥–¥–∞–Ω–æ–≤', '–í–æ—Ä–æ–±—å–µ–≤'
    ];

    const DESCRIPTIONS = [
      '–°–æ–∑–¥–∞—é –∫—Ä—É—Ç–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –±—Ä–µ–Ω–¥–æ–≤ –∏ —Å—Ç–∞—Ä—Ç–∞–ø–æ–≤. –†–∞–±–æ—Ç–∞—é —Å —Ç–æ–ø–æ–≤—ã–º–∏ –∫–æ–º–ø–∞–Ω–∏—è–º–∏.',
      '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ –∑–∞–Ω–∏–º–∞—é—Å—å —Å–æ–∑–¥–∞–Ω–∏–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞. –ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ –æ—Ç 500+ –ø—Ä–æ–µ–∫—Ç–æ–≤.',
      '–ü–æ–º–æ–≥–∞—é –±–∏–∑–Ω–µ—Å—É —Ä–∞—Å—Ç–∏ —á–µ—Ä–µ–∑ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç. –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –∫–∞–∂–¥–æ–º—É –∫–ª–∏–µ–Ω—Ç—É.',
      '–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Å—å –Ω–∞ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö. –ë—ã—Å—Ç—Ä–æ, –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ, –≤ —Å—Ä–æ–∫.',
      '–†–∞–±–æ—Ç–∞—é —Å –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–º–∏ –∏ —Ä–æ—Å—Å–∏–π—Å–∫–∏–º–∏ –±—Ä–µ–Ω–¥–∞–º–∏. –ë–æ–ª–µ–µ 7 –ª–µ—Ç –æ–ø—ã—Ç–∞.'
    ];

    const ALBUM_TITLES = [
      '–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ –ø—Ä–æ–µ–∫—Ç—ã', '–ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ 2024', '–õ—É—á—à–∏–µ —Ä–∞–±–æ—Ç—ã',
      '–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç—ã', '–ò–∑–±—Ä–∞–Ω–Ω–æ–µ', '–î–ª—è –±—Ä–µ–Ω–¥–æ–≤',
      '–õ–∏—á–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã', '–ö–æ–Ω—Ü–µ–ø—Ç—ã', '–î–ª—è –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è'
    ];

    let stats = { experts: 0, albums: 0, media: 0 };

    // ====== –£–¢–ò–õ–ò–¢–´ ======
    function log(message, type = 'info') {
      const logEl = document.getElementById('log');
      logEl.classList.add('active');
      const line = document.createElement('div');
      line.className = `log-line log-${type}`;
      const timestamp = new Date().toLocaleTimeString('ru-RU');
      line.textContent = `[${timestamp}] ${message}`;
      logEl.appendChild(line);
      logEl.scrollTop = logEl.scrollHeight;
    }

    function updateProgress(current, total) {
      const progress = document.getElementById('progress');
      const bar = document.getElementById('progressBar');
      progress.classList.add('active');
      const percent = Math.round((current / total) * 100);
      bar.style.width = percent + '%';
      bar.textContent = `${percent}% (${current}/${total})`;
    }

    function updateStats() {
      document.getElementById('statExperts').textContent = stats.experts;
      document.getElementById('statAlbums').textContent = stats.albums;
      document.getElementById('statMedia').textContent = stats.media;
    }

    function random(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function randomItem(array) {
      return array[Math.floor(Math.random() * array.length)];
    }

    function randomImageUrl() {
      const width = random(800, 1920);
      const height = random(600, 1080);
      const id = random(1, 1000);
      return `https://picsum.photos/id/${id}/${width}/${height}`;
    }

    // ====== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ======
    let currentUserId = null;

    async function sendAuthLink() {
      const email = document.getElementById('authEmail').value.trim();
      const authBtn = document.getElementById('authBtn');
      const authStatus = document.getElementById('authStatus');
      
      if (!email) {
        authStatus.textContent = '‚ùå –í–≤–µ–¥–∏ email!';
        authStatus.style.color = '#dc3545';
        return;
      }

      authBtn.disabled = true;
      authStatus.textContent = '‚è≥ –û—Ç–ø—Ä–∞–≤–ª—è—é —Å—Å—ã–ª–∫—É...';
      authStatus.style.color = '#856404';

      try {
        const { error } = await supabase.auth.signInWithOtp({
          email: email,
          options: {
            emailRedirectTo: window.location.href
          }
        });

        if (error) throw error;

        authStatus.textContent = '‚úÖ –°—Å—ã–ª–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –ü—Ä–æ–≤–µ—Ä—å –ø–æ—á—Ç—É –∏ –ø–µ—Ä–µ–π–¥–∏ –ø–æ —Å—Å—ã–ª–∫–µ.';
        authStatus.style.color = '#28a745';
        log(`üìß –°—Å—ã–ª–∫–∞ –¥–ª—è –≤—Ö–æ–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ ${email}`, 'success');
        
      } catch (error) {
        authStatus.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
        authStatus.style.color = '#dc3545';
        log(`‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ${error.message}`, 'error');
      } finally {
        authBtn.disabled = false;
      }
    }

    async function checkAuth() {
      const { data: { user }, error } = await supabase.auth.getUser();
      
      if (user) {
        currentUserId = user.id;
        
        // –°–∫—Ä—ã–≤–∞–µ–º –±–ª–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        document.getElementById('authBlock').style.display = 'none';
        
        // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        const settingsBlock = document.getElementById('settingsBlock');
        settingsBlock.style.opacity = '1';
        settingsBlock.style.pointerEvents = 'auto';
        
        // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
        document.getElementById('startBtn').disabled = false;
        
        log(`‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∫–∞–∫: ${user.email}`, 'success');
        log(`üÜî User ID: ${user.id}`, 'info');
        
        return true;
      }
      
      log('‚ö†Ô∏è –ù—É–∂–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö', 'warning');
      document.getElementById('startBtn').disabled = true;
      return false;
    }

    // ====== –ì–ï–ù–ï–†–ê–¶–ò–Ø –î–ê–ù–ù–´–• ======
    async function createFakeUser() {
      return currentUserId;
    }

    async function createExpert(userId) {
      const category = randomItem(CATEGORIES);
      const name = `${randomItem(NAMES)} ${randomItem(SURNAMES)}`;
      const role = randomItem(ROLES[category]);
      
      const expert = {
        user_id: userId,
        category: category,
        name: name,
        role: role,
        description: randomItem(DESCRIPTIONS),
        short_info: `${role} ‚Ä¢ ${random(1, 10)} –ª–µ—Ç –æ–ø—ã—Ç–∞`,
        price_from: `–æ—Ç ${random(5, 50)} 000 ‚ÇΩ`,
        delivery_time: `${random(1, 14)} –¥–Ω–µ–π`,
        telegram: `@${name.toLowerCase().replace(/\s+/g, '_')}`,
        instagram: `${name.toLowerCase().replace(/\s+/g, '.')}.pro`,
        portfolio_url: null,
        status: 'approved',
        works: []
      };

      const { data, error } = await supabase
        .from('experts')
        .insert([expert])
        .select()
        .single();

      if (error) throw error;
      
      stats.experts++;
      updateStats();
      return data;
    }

    async function createAlbum(expertId, userId, title, sortOrder) {
      const album = {
        expert_id: expertId,
        user_id: userId,
        title: title,
        sort_order: sortOrder
      };

      const { data, error } = await supabase
        .from('expert_albums')
        .insert([album])
        .select()
        .single();

      if (error) throw error;
      
      stats.albums++;
      updateStats();
      return data;
    }

    async function createMedia(expertId, userId, albumId, isFirst = false) {
      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
      const imageUrl = randomImageUrl();
      
      const media = {
        expert_id: expertId,
        user_id: userId,
        album_id: albumId,
        media_type: 'image',
        storage_path: imageUrl,
        file_name: `image_${Date.now()}_${random(1000, 9999)}.jpg`,
        mime_type: 'image/jpeg',
        size_bytes: random(500000, 5000000),
        is_cover: isFirst
      };

      const { data, error } = await supabase
        .from('expert_media')
        .insert([media])
        .select()
        .single();

      if (error) throw error;
      
      stats.media++;
      updateStats();
      return data;
    }

    // ====== –û–°–ù–û–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø ======
    async function startGeneration() {
      const startBtn = document.getElementById('startBtn');
      const clearBtn = document.getElementById('clearBtn');
      
      startBtn.disabled = true;
      clearBtn.disabled = true;
      
      const expertsCount = parseInt(document.getElementById('expertsCount').value);
      const albumsPerExpert = parseInt(document.getElementById('albumsPerExpert').value);
      const mediaPerAlbum = parseInt(document.getElementById('mediaPerAlbum').value);

      log('üöÄ –ù–∞—á–∏–Ω–∞—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö...', 'info');
      log(`üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: ${expertsCount} —ç–∫—Å–ø–µ—Ä—Ç–æ–≤, ${albumsPerExpert} –∞–ª—å–±–æ–º–æ–≤, ${mediaPerAlbum} –º–µ–¥–∏–∞`, 'info');

      try {
        const userId = await createFakeUser();
        
        for (let i = 0; i < expertsCount; i++) {
          updateProgress(i + 1, expertsCount);
          
          // –°–æ–∑–¥–∞–µ–º —ç–∫—Å–ø–µ—Ä—Ç–∞
          const expert = await createExpert(userId);
          log(`‚úÖ –°–æ–∑–¥–∞–Ω —ç–∫—Å–ø–µ—Ä—Ç #${i + 1}: ${expert.name}`, 'success');

          // –°–æ–∑–¥–∞–µ–º –∞–ª—å–±–æ–º—ã
          const albumCount = random(2, albumsPerExpert);
          for (let j = 0; j < albumCount; j++) {
            const album = await createAlbum(
              expert.id,
              userId,
              randomItem(ALBUM_TITLES),
              j
            );

            // –°–æ–∑–¥–∞–µ–º –º–µ–¥–∏–∞
            const mediaCount = random(3, mediaPerAlbum);
            for (let k = 0; k < mediaCount; k++) {
              await createMedia(expert.id, userId, album.id, k === 0);
            }
          }

          // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∑–∏—Ç—å API
          if (i % 10 === 0 && i > 0) {
            await new Promise(resolve => setTimeout(resolve, 500));
          }
        }

        log('üéâ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!', 'success');
        log(`üìà –°–æ–∑–¥–∞–Ω–æ: ${stats.experts} —ç–∫—Å–ø–µ—Ä—Ç–æ–≤, ${stats.albums} –∞–ª—å–±–æ–º–æ–≤, ${stats.media} –º–µ–¥–∏–∞`, 'success');
        
      } catch (error) {
        log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
        console.error(error);
      } finally {
        startBtn.disabled = false;
        clearBtn.disabled = false;
      }
    }

    // ====== –û–ß–ò–°–¢–ö–ê –î–ê–ù–ù–´–• ======
    async function clearAllData() {
      if (!confirm('‚ö†Ô∏è –£–¥–∞–ª–∏—Ç—å –í–°–ï —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
        return;
      }

      const startBtn = document.getElementById('startBtn');
      const clearBtn = document.getElementById('clearBtn');
      
      startBtn.disabled = true;
      clearBtn.disabled = true;

      try {
        log('üóëÔ∏è –ù–∞—á–∏–Ω–∞—é –æ—á–∏—Å—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö...', 'warning');

        // –£–¥–∞–ª—è–µ–º –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (–∏–∑-–∑–∞ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π)
        const { error: mediaError } = await supabase
          .from('expert_media')
          .delete()
          .neq('id', '00000000-0000-0000-0000-000000000000');
        
        if (mediaError) throw mediaError;
        log('‚úÖ –ú–µ–¥–∏–∞ —É–¥–∞–ª–µ–Ω—ã', 'success');

        const { error: albumsError } = await supabase
          .from('expert_albums')
          .delete()
          .neq('id', '00000000-0000-0000-0000-000000000000');
        
        if (albumsError) throw albumsError;
        log('‚úÖ –ê–ª—å–±–æ–º—ã —É–¥–∞–ª–µ–Ω—ã', 'success');

        const { error: expertsError } = await supabase
          .from('experts')
          .delete()
          .neq('id', '00000000-0000-0000-0000-000000000000');
        
        if (expertsError) throw expertsError;
        log('‚úÖ –≠–∫—Å–ø–µ—Ä—Ç—ã —É–¥–∞–ª–µ–Ω—ã', 'success');

        stats = { experts: 0, albums: 0, media: 0 };
        updateStats();
        
        log('üéâ –í—Å–µ –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω—ã!', 'success');
        
      } catch (error) {
        log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ${error.message}`, 'error');
        console.error(error);
      } finally {
        startBtn.disabled = false;
        clearBtn.disabled = false;
      }
    }

    // ====== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ======
    async function init() {
      log('‚úÖ –°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ', 'info');
      
      // –û–±—Ä–∞–±–æ—Ç–∫–∞ auth callback (–µ—Å–ª–∏ –ø—Ä–∏—à–ª–∏ –ø–æ —Å—Å—ã–ª–∫–µ –∏–∑ email)
      const hashParams = new URLSearchParams(window.location.hash.substring(1));
      if (hashParams.get('access_token')) {
        log('üîÑ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∏–∑ email...', 'info');
        // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤
        await new Promise(resolve => setTimeout(resolve, 1000));
      }
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
      const isAuth = await checkAuth();
      
      if (!isAuth) {
        log('‚ÑπÔ∏è –í–≤–µ–¥–∏ email –∏ –≤–æ–π–¥–∏ –≤ —Å–∏—Å—Ç–µ–º—É –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π', 'info');
      } else {
        log('‚ÑπÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∏ –Ω—É–∂–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –Ω–∞–∂–º–∏ "–ù–∞—á–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é"', 'info');
      }
    }

    // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>

