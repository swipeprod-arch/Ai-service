<!DOCTYPE html> <html> <head> <meta charset="utf-8" /> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <!--metatextblock--> <title>Исполнители</title> <meta property="og:url" content="experts" /> <meta property="og:title" content="Исполнители" /> <meta property="og:description" content="" /> <meta property="og:type" content="website" /> <link rel="canonical" href="experts"> <!--/metatextblock--> <meta name="format-detection" content="telephone=no" /> <meta http-equiv="x-dns-prefetch-control" content="on"> <link rel="dns-prefetch" href="https://ws.tildacdn.com">  <link rel="shortcut icon" href="images/tildafavicon.ico" type="image/x-icon" /> <!-- Assets --> <script src="https://neo.tildacdn.com/js/tilda-fallback-1.0.min.js" async charset="utf-8"></script> <link rel="stylesheet" href="css/tilda-grid-3.0.min.css" type="text/css" media="all" onerror="this.loaderr='y';"/> <link rel="stylesheet" href="css/tilda-blocks-page103811056.min.css?t=1765875826" type="text/css" media="all" onerror="this.loaderr='y';" /> <link rel="stylesheet" type="text/css" href="css/custom.css?t=1767535575"> <link rel="stylesheet" href="css/fonts-tildasans.css" type="text/css" media="all" onerror="this.loaderr='y';" /> <script nomodule src="js/tilda-polyfill-1.0.min.js" charset="utf-8"></script> <script type="text/javascript">function t_onReady(func) {if(document.readyState!='loading') {func();} else {document.addEventListener('DOMContentLoaded',func);}}
function t_onFuncLoad(funcName,okFunc,time) {if(typeof window[funcName]==='function') {okFunc();} else {setTimeout(function() {t_onFuncLoad(funcName,okFunc,time);},(time||100));}}</script> <script src="js/jquery-1.10.2.min.js" charset="utf-8" onerror="this.loaderr='y';"></script> <script src="js/tilda-scripts-3.0.min.js" charset="utf-8" defer onerror="this.loaderr='y';"></script> <script src="js/tilda-blocks-page103811056.min.js?t=1765875826" charset="utf-8" async onerror="this.loaderr='y';"></script> <script src="js/lazyload-1.3.min.export.js" charset="utf-8" async onerror="this.loaderr='y';"></script> <script src="js/tilda-events-1.0.min.js" charset="utf-8" async onerror="this.loaderr='y';"></script> <!-- nominify begin --><script>
window.AI_BIRZHA = {
  SUPABASE_URL: "https://orxzpefskbkcyuoobkol.supabase.co",
  SUPABASE_ANON_KEY: "sb_publishable_fj9X3SDLjXiL0v3pajtMwA_fTYhN3us",

  AUTH_PATH: "/auth",
  APPLY_PATH: "/apply",
  ADD_PATH: "/add",
  EXPERTS_PATH: "/experts"
};
</script> <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script> <script>
(function initSupabase(){
  function tryInit(){
    if(!window.AI_BIRZHA) return;

    // уже создано
    if(window.AI_BIRZHA.sb) return;

    // ждём загрузку библиотеки supabase-js
    if(window.supabase && typeof window.supabase.createClient === "function"){
      window.AI_BIRZHA.sb = window.supabase.createClient(
        window.AI_BIRZHA.SUPABASE_URL,
        window.AI_BIRZHA.SUPABASE_ANON_KEY
      );
      return;
    }

    setTimeout(tryInit, 80);
  }
  tryInit();
})();
</script> <style>
/* ====== AI-Биржа • Neumorphism Light Theme ====== */
:root{
  --bg:#EEF3FA;
  --surface:#EEF3FA;
  --surface2:#F6F9FF;

  --text:#13233F;
  --muted:#5B6C86;

  --radius:22px;
  --radius-sm:16px;
  --max:1120px;

  --shadow-dark: rgba(163,177,198,.55);
  --shadow-light: rgba(255,255,255,.92);

  --stroke: rgba(255,255,255,.65);

  /* Синий градиент как в референсе */
  --accent1:#1E78FF;
  --accent2:#00B7FF;
  --accent-grad: linear-gradient(135deg, var(--accent1) 0%, var(--accent2) 100%);
}

/* база */
*{box-sizing:border-box}
html,body{
  margin:0;padding:0;
  background: radial-gradient(1200px 700px at 15% -10%, rgba(30,120,255,.18), transparent 60%),
              radial-gradient(900px 600px at 90% 0%, rgba(0,183,255,.12), transparent 55%),
              var(--bg) !important;
  color:var(--text) !important;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
}
img{max-width:100%;display:block}
a{color:inherit;text-decoration:none}

/* контейнер */
.container{max-width:var(--max);margin:0 auto;padding:0 18px}

/* навбар */
.nav{
  position:sticky;top:0;z-index:50;
  background: rgba(238,243,250,.75) !important;
  backdrop-filter: blur(14px);
  border-bottom: 1px solid rgba(255,255,255,.55);
  box-shadow: 10px 10px 22px rgba(163,177,198,.35);
  width: 100%;
}
.nav-inner{display:flex;align-items:center;justify-content:space-between;gap:14px;padding:14px 0;width:100%;box-sizing:border-box;}
.brand{display:flex !important;align-items:center !important;gap:10px !important;font-weight:900;letter-spacing:.2px;overflow:visible !important;max-width:none !important;flex-shrink:0 !important;}
.brand span:not(.logo){white-space:nowrap !important;overflow:visible !important;text-overflow:unset !important;max-width:none !important;}
@media (min-width: 901px) {
  .brand span:not(.logo){font-size:inherit !important;overflow:visible !important;text-overflow:unset !important;max-width:none !important;}
}
.logo{
  width:34px;height:34px;border-radius:14px;
  background: var(--accent-grad);
  box-shadow: 10px 10px 20px rgba(163,177,198,.45), -10px -10px 20px rgba(255,255,255,.85);
}
.nav-links{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
.nav-links a{
  padding:10px 12px;border-radius:16px;
  color:var(--muted) !important;
  background: transparent;
}
.nav-links a:hover{
  color:var(--text) !important;
  background: var(--surface);
  box-shadow: 8px 8px 18px rgba(163,177,198,.35), -8px -8px 18px rgba(255,255,255,.9);
}

/* кнопки */
.btn{
  display:inline-flex;align-items:center;justify-content:center;gap:10px;
  padding:12px 16px;border-radius:18px;
  border:1px solid var(--stroke);
  background: var(--surface);
  color:var(--text);
  cursor:pointer;
  transition: .15s transform ease, .15s box-shadow ease, .15s filter ease;
  box-shadow: 10px 10px 22px rgba(163,177,198,.45), -10px -10px 22px rgba(255,255,255,.9);
}
.btn:hover{transform: translateY(-1px); filter:saturate(1.05)}
.btn:active{
  transform: translateY(0);
  box-shadow: inset 10px 10px 22px rgba(163,177,198,.45), inset -10px -10px 22px rgba(255,255,255,.9);
}
.btn.primary{
  background: var(--accent-grad);
  border-color: rgba(30,120,255,.18);
  color:#fff;
  box-shadow: 12px 12px 26px rgba(30,120,255,.28), -10px -10px 22px rgba(255,255,255,.75);
}
.btn.primary:hover{filter:saturate(1.1) brightness(1.02)}
.btn.green{ /* если где-то осталась зелёная — делаем её просто "акцентной" */
  background: var(--accent-grad);
  border-color: rgba(0,183,255,.18);
  color:#fff;
}

/* hero */
.hero{padding:56px 0 26px}
.hero-grid{display:grid;grid-template-columns: 1.25fr .75fr; gap:20px; align-items:stretch}
@media (max-width: 900px){.hero-grid{grid-template-columns:1fr} .nav-links{display:none}}

/* карточки */
.h-card,
.card{
  background: linear-gradient(145deg, #F8FBFF, #E7EDF7) !important;
  border:1px solid rgba(255,255,255,.65);
  border-radius: var(--radius);
  box-shadow: 14px 14px 28px rgba(163,177,198,.45), -14px -14px 28px rgba(255,255,255,.92);
}
.h-card{padding:26px}
.card{padding:16px;transition:.15s transform ease, .15s box-shadow ease}
.card:hover{
  transform: translateY(-2px);
  box-shadow: 18px 18px 34px rgba(163,177,198,.42), -18px -18px 34px rgba(255,255,255,.94);
}

/* заголовки */
.h-eyebrow{color:var(--muted);font-weight:700;letter-spacing:.2px}
.h-title{
  font-size:40px;line-height:1.05;margin:10px 0 12px;font-weight:900;
  background: var(--accent-grad);
  -webkit-background-clip:text;
  background-clip:text;
  color:transparent;
}
@media (max-width: 520px){.h-title{font-size:34px}}
.section-title{
  font-size:22px;margin:0 0 12px;font-weight:900;
  background: var(--accent-grad);
  -webkit-background-clip:text;
  background-clip:text;
  color:transparent;
}
.h-sub,.section-sub{color:var(--muted);line-height:1.55}
.card h3{margin:0 0 8px;font-size:18px;color:var(--text)}
.card p{margin:0 0 12px;color:var(--muted);line-height:1.55}

/* поиск + инпуты (вдавленный эффект) */
.searchbox{
  display:flex;gap:10px;flex-wrap:wrap;
  padding:12px;border-radius: 20px;
  background: var(--surface);
  border:1px solid rgba(255,255,255,.7);
  box-shadow: inset 10px 10px 22px rgba(163,177,198,.45), inset -10px -10px 22px rgba(255,255,255,.92);
}
.searchbox input,
input,select,textarea{
  width:100%;
  padding:12px 12px;border-radius:16px;
  border:1px solid rgba(255,255,255,.7);
  background: var(--surface);
  color: var(--text);
  outline:none;
  box-shadow: inset 10px 10px 22px rgba(163,177,198,.40), inset -10px -10px 22px rgba(255,255,255,.92);
}
.searchbox input::placeholder{color: rgba(91,108,134,.8)}
label{font-size:13px;color:var(--muted)}

/* теги/плашки */
.tag{
  font-size:12px;
  color: var(--muted);
  padding:7px 12px;border-radius:999px;
  border:1px solid rgba(255,255,255,.7);
  background: var(--surface);
  box-shadow: inset 8px 8px 18px rgba(163,177,198,.30), inset -8px -8px 18px rgba(255,255,255,.92);
}
.tagrow{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0 0}

/* KPI */
.kpis{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
.kpi{
  flex:1 1 150px;
  border-radius:18px;
  padding:12px;
  border:1px solid rgba(255,255,255,.7);
  background: var(--surface);
  box-shadow: inset 10px 10px 22px rgba(163,177,198,.35), inset -10px -10px 22px rgba(255,255,255,.92);
}
.kpi .n{font-weight:900;font-size:18px;color:var(--text)}
.kpi .t{color:var(--muted);font-size:12px;margin-top:2px}

/* разделы */
.section{padding:26px 0}
.grid{display:grid;gap:14px;grid-template-columns: repeat(3, minmax(0, 1fr));}
@media (max-width: 900px){.grid{grid-template-columns: repeat(2, minmax(0, 1fr));}}
@media (max-width: 560px){.grid{grid-template-columns: 1fr;}}
.list{margin:0;padding-left:16px;color:var(--muted);line-height:1.6}
hr.sep{border:none;border-top:1px solid rgba(163,177,198,.35);margin:18px 0}

/* футер */
.footer{
  padding:34px 0;
  color:var(--muted);
  border-top:1px solid rgba(163,177,198,.35);
  margin-top:34px;
}
.footer a{color:var(--muted)}
.footer a:hover{color:var(--text)}
.foot-grid{display:grid;grid-template-columns: 1.2fr .8fr;gap:16px}
@media (max-width: 820px){.foot-grid{grid-template-columns:1fr}}

/* badges */
.badge{
  display:inline-flex;gap:8px;align-items:center;
  font-size:12px;font-weight:900;
  padding:7px 12px;border-radius:999px;
  background: var(--surface);
  color: var(--text);
  border:1px solid rgba(255,255,255,.75);
  box-shadow: 10px 10px 22px rgba(163,177,198,.35), -10px -10px 22px rgba(255,255,255,.92);
}
.badge.purple{
  background: var(--accent-grad);
  color:#fff;
  border-color: rgba(30,120,255,.18);
}

/* FIX: чтобы Tilda не перекрашивала ссылки */
#allrecords a,
#allrecords a:visited,
.t-records a,
.t-records a:visited{
  color: inherit !important;
  text-decoration: none !important;
}
</style> <script>
window.addEventListener('DOMContentLoaded', function () {

  /* 1) Авто-фикс ссылок: /services.html -> /services */
  document.querySelectorAll('a[href]').forEach(function(a){
    let href = a.getAttribute('href');
    if(!href) return;

    // пропускаем внешние и служебные ссылки
    if (
      href.startsWith('http') ||
      href.startsWith('mailto:') ||
      href.startsWith('tel:') ||
      href.startsWith('#')
    ) return;

    // делаем ссылку абсолютной (чтобы "services.html" тоже поймать)
    if (!href.startsWith('/')) href = '/' + href;

    // режем .html (но НЕ для /pageXXXXXXXX.html и /gallery.html — иначе ломаются переходы)
    if (href.endsWith('.html') && !/\/page\d+\.html$/i.test(href) && href !== '/gallery.html') href = href.slice(0, -5);

    // index.html -> /
    if (href === '/index') href = '/';

    a.setAttribute('href', href);
  });

  /* 2) Настрой адрес страницы заявки (если у тебя не /apply — поменяй) */
  const APPLY_PATH = '/apply';

  /* 3) Поиск на главной: открывает модальное окно умного поиска */
  const sform = document.querySelector('form[data-search]');
  if (sform) {
    sform.addEventListener('submit', function (e) {
      e.preventDefault();
      const input = sform.querySelector('input[name="q"]');
      const q = input ? input.value.trim() : '';
      if (!q) {
        alert('Введите запрос для поиска');
        return;
      }
      // Открываем модальное окно умного поиска
      if (typeof window.openSearchModal === 'function') {
        window.openSearchModal(q);
      } else {
        location.href = APPLY_PATH + '?q=' + encodeURIComponent(q);
      }
    });
  }

  /* 4) Автозаполнение заявки по параметрам */
  const qs = new URLSearchParams(location.search);
  const setVal = (id, v) => { const el = document.getElementById(id); if(el && v) el.value = v; };
  setVal('req_text', qs.get('q'));
  setVal('category', qs.get('cat'));
  setVal('expert', qs.get('expert'));

  /* 5) Демо-отправка (пока не подключил формы) */
  const form = document.querySelector('form[data-static-submit]');
  if (form) {
    form.addEventListener('submit', function (e) {
      e.preventDefault();
      alert('Демо: форма не подключена. Подключи в Tilda к почте/CRM/Telegram.');
    });
  }

});
</script> <style>
.pick-grid{
  display:grid;
  grid-template-columns: repeat(6, minmax(0, 1fr));
  gap:12px;
  margin-top:12px;
}
@media (max-width: 980px){ .pick-grid{ grid-template-columns: repeat(3, minmax(0, 1fr)); } }
@media (max-width: 560px){ .pick-grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); } }

.pick-btn{
  width:100%;
  border:1px solid rgba(255,255,255,.75);
  border-radius:18px;
  padding:14px 12px;
  background: var(--surface);
  color: var(--text);
  font-weight:900;
  cursor:pointer;
  box-shadow: 10px 10px 22px rgba(163,177,198,.45), -10px -10px 22px rgba(255,255,255,.92);
  transition: .15s transform ease, .15s box-shadow ease, .15s filter ease;
}
.pick-btn:hover{ transform: translateY(-1px); filter:saturate(1.05); }
.pick-btn:active{
  transform: translateY(0);
  box-shadow: inset 10px 10px 22px rgba(163,177,198,.45), inset -10px -10px 22px rgba(255,255,255,.92);
}
.pick-btn.active{
  background: var(--accent-grad);
  color:#fff;
  border-color: rgba(30,120,255,.18);
  box-shadow: 12px 12px 26px rgba(30,120,255,.25), -10px -10px 22px rgba(255,255,255,.75);
}
.pick-btn.ghost{ opacity:.85; }
</style> <script>
window.addEventListener('DOMContentLoaded', function () {

  function applyCat(cat){
    const buttons = document.querySelectorAll('.cat-picker [data-cat]');
    const cards = document.querySelectorAll('[data-expert-card]');

    buttons.forEach(function(b){
      b.classList.toggle('active', !!cat && b.dataset.cat === cat);
    });

    cards.forEach(function(c){
      const ok = !cat || c.dataset.cat === cat;
      c.style.display = ok ? '' : 'none';
    });

    // записываем в URL ?cat=..., чтобы можно было делиться ссылкой
    const u = new URL(window.location.href);
    if(cat) u.searchParams.set('cat', cat);
    else u.searchParams.delete('cat');
    history.replaceState(null, '', u.toString());
  }

  // клик по кнопкам
  document.querySelectorAll('.cat-picker [data-cat]').forEach(function(btn){
    btn.addEventListener('click', function(){
      applyCat(btn.dataset.cat || '');
    });
  });

  // автоприменение из URL
  const qs = new URLSearchParams(location.search);
  applyCat(qs.get('cat') || '');

});
</script> <style>
/* 1) Всегда белый текст на синей кнопке в шапке */
#allrecords .nav .btn.primary,
#allrecords .nav .btn.primary *,
.t-records .nav .btn.primary,
.t-records .nav .btn.primary *{
  color:#fff !important;
}
</style> <script>
(async function () {
  // Находим синюю кнопку в шапке (там где раньше "Оставить заявку")
  function findHeaderPrimaryBtn(){
    const nav = document.querySelector('.nav');
    if(!nav) return null;
    return nav.querySelector('.nav-cta .btn.primary') || nav.querySelector('.btn.primary');
  }

  // Ждём, пока подключится Supabase (window.AI_BIRZHA.sb)
  async function waitSupabase(){
    for(let i=0;i<50;i++){
      if(window.AI_BIRZHA && window.AI_BIRZHA.sb) return window.AI_BIRZHA.sb;
      await new Promise(r => setTimeout(r,120));
    }
    return null;
  }

  const btn = findHeaderPrimaryBtn();
  if(!btn) return;

  // Дефолт (если не залогинен или нет карточки)
  function setPortfolio(){
    btn.textContent = 'Разместить портфолио';
    btn.setAttribute('href', '/add');   // страница создания карточки/кабинета
    btn.classList.add('primary');
    btn.style.color = '#fff';
  }

  // Если залогинен и карточка уже есть
  function setCabinet(){
    btn.textContent = 'Личный кабинет';
    btn.setAttribute('href', '/add');   // кабинет (у тебя он на /add)
    btn.classList.add('primary');
    btn.style.color = '#fff';
  }

  setPortfolio();

  const sb = await waitSupabase();
  if(!sb) return;

  const { data: authData } = await sb.auth.getUser();
  const user = authData?.user;

  // Если не авторизован — оставляем "Разместить портфолио"
  if(!user) return;

  // Авторизован: проверяем, есть ли карточка (experts.user_id = user.id)
  try{
    const { data, error } = await sb
      .from('experts')
      .select('id')
      .eq('user_id', user.id)
      .limit(1);

    if(!error && data && data.length > 0){
      setCabinet();
    } else {
      setPortfolio();
    }
  } catch(e){
    // Если что-то пошло не так, но пользователь авторизован — пусть будет кабинет
    setCabinet();
  }
})();
</script> <style>
/* Жёстко делаем белый текст на синей кнопке в шапке (обходит твой #allrecords a {color:inherit!important}) */
#allrecords .nav .nav-cta a.ai-cta,
#allrecords .nav .nav-cta a.ai-cta:visited,
#allrecords .nav .nav-cta a.ai-cta *,
#allrecords .nav a.ai-cta,
#allrecords .nav a.ai-cta *{
  color:#fff !important;
  -webkit-text-fill-color:#fff !important;
}
</style> <script>
(function(){
  const ADD_PATH   = (window.AI_BIRZHA && window.AI_BIRZHA.ADD_PATH) ? window.AI_BIRZHA.ADD_PATH : "/add";
  const APPLY_PATH = (window.AI_BIRZHA && window.AI_BIRZHA.APPLY_PATH) ? window.AI_BIRZHA.APPLY_PATH : "/apply";

  function cleanHref(h){
    if(!h) return "";
    return String(h)
      .replace(location.origin, "")
      .replace(/\.html(?=($|\?|\#))/, "");
  }

  function findHeaderBtn(){
    const nav = document.querySelector(".nav") || document.querySelector("header");
    if(!nav) return null;

    const links = Array.from(nav.querySelectorAll("a"));

    // 1) сначала ищем ссылку на /apply (старая кнопка)
    let btn = links.find(a => cleanHref(a.getAttribute("href")).startsWith(APPLY_PATH));

    // 2) если нет — ищем по тексту "Оставить заявку"
    if(!btn) btn = links.find(a => (a.textContent || "").trim().toLowerCase() === "оставить заявку");

    // 3) если нет — берём последнюю кнопку в .nav-cta
    if(!btn){
      const cta = nav.querySelector(".nav-cta");
      if(cta) btn = cta.querySelector("a:last-of-type");
    }

    return btn || null;
  }

  function setBtn(btn, mode){
    // фиксируем стиль и текст
    btn.classList.add("ai-cta", "btn", "primary");
    btn.setAttribute("href", ADD_PATH);
    btn.textContent = (mode === "cabinet") ? "Личный кабинет" : "Разместить портфолио";

    // жёстко перехватываем клик, чтобы НЕ открывалась старая /apply
    btn.addEventListener("click", function(e){
      e.preventDefault();
      location.href = ADD_PATH;
    }, true);
  }

  async function waitSupabase(){
    for(let i=0;i<120;i++){
      if(window.AI_BIRZHA && window.AI_BIRZHA.sb) return window.AI_BIRZHA.sb;
      await new Promise(r=>setTimeout(r,100));
    }
    return null;
  }

  async function init(){
    // ждём пока шапка реально появится на странице
    let btn = null;
    for(let i=0;i<120;i++){
      btn = findHeaderBtn();
      if(btn) break;
      await new Promise(r=>setTimeout(r,100));
    }
    if(!btn) return;

    // дефолт
    setBtn(btn, "portfolio");

    // если есть supabase — определяем, есть ли карточка
    const sb = await waitSupabase();
    if(!sb) return;

    const { data: authData } = await sb.auth.getUser();
    const user = authData?.user;
    if(!user) return;

    const { data, error } = await sb.from("experts").select("id").eq("user_id", user.id).limit(1);
    if(!error && data && data.length > 0) setBtn(btn, "cabinet");
    else setBtn(btn, "portfolio");
  }

  if(document.readyState === "loading") document.addEventListener("DOMContentLoaded", init);
  else init();
})();
</script> <style>
/* Теги-чипсы под полем "Роль" (только на /add) */
#roleChips{ margin-top:10px; display:flex; flex-wrap:wrap; gap:8px; }
#roleChips .tag{ cursor:pointer; user-select:none; }
#roleChips .tag:after{ content:" ×"; opacity:.55; margin-left:4px; }
</style> <script>
(function(){
  function normTags(str){
    return String(str||"")
      .split(",")
      .map(s => s.trim())
      .filter(Boolean)
      .slice(0, 20);
  }
  function uniq(arr){
    const out=[], seen=new Set();
    for(const x of arr){
      const k = x.toLowerCase();
      if(!seen.has(k)){ seen.add(k); out.push(x); }
    }
    return out;
  }

  // 1) /add: превращаем строку в чипсы под инпутом
  function enhanceRoleInput(){
    if(!location.pathname.startsWith("/add")) return;

    const input = document.getElementById("f_role");
    if(!input || input.dataset.tagsEnhanced) return;
    input.dataset.tagsEnhanced = "1";

    const field = input.closest(".field") || input.parentElement;
    if(!field) return;

    const chips = document.createElement("div");
    chips.id = "roleChips";
    chips.className = "tagrow";
    field.appendChild(chips);

    function renderChips(){
      const tags = uniq(normTags(input.value));
      chips.innerHTML = tags.map(t => `<span class="tag" data-t="${t.replace(/"/g,"&quot;")}">${t}</span>`).join("");
    }

    function normalizeAndRender(){
      const tags = uniq(normTags(input.value));
      input.value = tags.join(", ");
      renderChips();
    }

    chips.addEventListener("click", (e)=>{
      const tagEl = e.target.closest(".tag");
      if(!tagEl) return;
      const t = (tagEl.getAttribute("data-t") || tagEl.textContent || "").trim();
      const tags = uniq(normTags(input.value)).filter(x => x.toLowerCase() !== t.toLowerCase());
      input.value = tags.join(", ");
      renderChips();
    });

    input.addEventListener("input", renderChips);
    input.addEventListener("blur", normalizeAndRender);

    normalizeAndRender();
  }

  // 2) В каталоге/профиле: если где-то есть .tag с запятыми — разбиваем на отдельные плашки
  function splitCommaTagsEverywhere(root=document){
    const tags = root.querySelectorAll ? root.querySelectorAll(".tagrow .tag") : [];
    tags.forEach(tag=>{
      if(tag.closest && tag.closest("#roleChips")) return; // не трогаем чипсы в кабинете

      const txt = (tag.textContent || "").trim();
      if(!txt.includes(",")) return;

      const parts = uniq(normTags(txt));
      if(parts.length <= 1) return;

      const frag = document.createDocumentFragment();
      parts.forEach(p=>{
        const el = tag.cloneNode(false);
        el.className = tag.className;
        el.textContent = p;
        frag.appendChild(el);
      });
      tag.replaceWith(frag);
    });
  }

  function runAll(){
    enhanceRoleInput();
    splitCommaTagsEverywhere(document);
  }

  if(document.readyState === "loading") document.addEventListener("DOMContentLoaded", runAll);
  else runAll();

 
</script> <style>
/* ===== FAST TAGS (без MutationObserver) ===== */
#roleChips{ margin-top:10px; display:flex; flex-wrap:wrap; gap:8px; }
#roleChips .tag{ cursor:pointer; user-select:none; }
#roleChips .tag:after{ content:" ×"; opacity:.55; margin-left:4px; }

.ai-linkrow{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
.ai-linkrow .btn{white-space:nowrap}

/* Белый текст на синей */
.btn.primary, .btn.primary *{ color:#fff !important; -webkit-text-fill-color:#fff !important; }
</style> <script>
(function(){
  /* ---------- utils ---------- */
  function normTags(str){
    return String(str||"")
      .split(",")
      .map(s=>s.trim())
      .filter(Boolean)
      .slice(0, 30);
  }
  function uniq(arr){
    const out=[], seen=new Set();
    for(const x of arr){
      const k=x.toLowerCase();
      if(!seen.has(k)){ seen.add(k); out.push(x); }
    }
    return out;
  }
  function splitCommaTagsOnce(){
    document.querySelectorAll(".tagrow .tag").forEach(tag=>{
      if(tag.closest && tag.closest("#roleChips")) return;
      const txt=(tag.textContent||"").trim();
      if(!txt.includes(",")) return;
      const parts=uniq(normTags(txt));
      if(parts.length<=1) return;

      const frag=document.createDocumentFragment();
      parts.forEach(p=>{
        const el=tag.cloneNode(false);
        el.className=tag.className;
        el.textContent=p;
        frag.appendChild(el);
      });
      tag.replaceWith(frag);
    });
  }

  function extractTgNick(v){
    v=String(v||"").trim();
    if(!v) return "";
    const m=v.match(/(?:t\.me|telegram\.me)\/([A-Za-z0-9_]{3,})/i);
    if(m && m[1]) return m[1];
    return v.replace(/^@+/,"").trim();
  }
  function tgLink(v){
    const nick=extractTgNick(v);
    return nick ? ("https://t.me/" + nick) : "";
  }
  function normalizeWebsite(v){
    v=String(v||"").trim();
    if(!v) return "";
    if(/^https?:\/\//i.test(v)) return v;
    return "https://" + v;
  }
  function normalizeInstagram(v){
    v=String(v||"").trim();
    if(!v) return "";
    if(/^https?:\/\//i.test(v)) return v;
    v=v.replace(/^@+/,"").trim();
    return v ? ("https://www.instagram.com/" + v + "/") : "";
  }

  async function waitSb(){
    for(let i=0;i<80;i++){
      if(window.AI_BIRZHA && window.AI_BIRZHA.sb) return window.AI_BIRZHA.sb;
      await new Promise(r=>setTimeout(r,120));
    }
    return null;
  }

  /* ---------- 1) /add: чипсы под полем тегов ---------- */
  function enhanceRoleInput(){
    if(!location.pathname.startsWith("/add")) return;
    const input=document.getElementById("f_role");
    if(!input || input.dataset.tagsEnhanced) return;
    input.dataset.tagsEnhanced="1";

    const field=input.closest(".field") || input.parentElement;
    if(!field) return;

    const chips=document.createElement("div");
    chips.id="roleChips";
    chips.className="tagrow";
    field.appendChild(chips);

    function render(){
      const tags=uniq(normTags(input.value));
      chips.innerHTML=tags.map(t=>`<span class="tag" data-t="${t.replace(/"/g,"&quot;")}">${t}</span>`).join("");
    }
    function normalize(){
      const tags=uniq(normTags(input.value));
      input.value=tags.join(", ");
      render();
    }

    chips.addEventListener("click",(e)=>{
      const el=e.target.closest(".tag");
      if(!el) return;
      const t=(el.getAttribute("data-t")||el.textContent||"").trim();
      const tags=uniq(normTags(input.value)).filter(x=>x.toLowerCase()!==t.toLowerCase());
      input.value=tags.join(", ");
      render();
    });

    input.addEventListener("input", render);
    input.addEventListener("blur", normalize);

    normalize();
  }

  /* ---------- 2) Страница карточки: дорисовать Instagram/Сайт/Описание ---------- */
  async function enhanceExpertPage(){
    const qs=new URLSearchParams(location.search);
    const id = qs.get("id") || qs.get("expert") || qs.get("expert_id");
    if(!id) return; // нет id -> не страница карточки

    // не трогаем страницу списка /experts
    if(location.pathname === "/experts") return;

    const sb=await waitSb();
    if(!sb) return;

    const { data: expert, error } = await sb
      .from("experts")
      .select("id, description, instagram, website, telegram")
      .eq("id", id)
      .single();

    if(error || !expert) return;

    // Куда вставлять: ищем кнопку "Написать сообщение"
    const msgBtn = Array.from(document.querySelectorAll("a.btn, button.btn"))
      .find(el => /написать сообщение/i.test((el.textContent||"").trim()));

    let host = null;
    if(msgBtn && msgBtn.parentElement) host = msgBtn.parentElement;

    // если не нашли — вставим в основной h-card
    if(!host){
      host = document.querySelector(".h-card") || document.querySelector(".container") || document.body;
    }

    // Контакты (Instagram/Сайт)
    const ig = normalizeInstagram(expert.instagram);
    const site = normalizeWebsite(expert.website);

    if((ig || site) && !document.getElementById("aiLinksRow")){
      const row = document.createElement("div");
      row.className="ai-linkrow";
      row.id="aiLinksRow";

      if(ig){
        const a=document.createElement("a");
        a.className="btn";
        a.href=ig; a.target="_blank"; a.rel="noopener";
        a.textContent="Instagram";
        row.appendChild(a);
      }
      if(site){
        const a=document.createElement("a");
        a.className="btn";
        a.href=site; a.target="_blank"; a.rel="noopener";
        a.textContent="Сайт";
        row.appendChild(a);
      }

      // вставляем рядом с кнопками
      if(msgBtn && msgBtn.parentElement){
        msgBtn.parentElement.appendChild(row);
      }else{
        host.appendChild(row);
      }
    }

    // Если телега кнопка есть, но ссылка пустая — можем поправить
    const tg = tgLink(expert.telegram);
    if(tg && msgBtn && msgBtn.tagName.toLowerCase()==="a"){
      msgBtn.href = tg;
      msgBtn.target = "_blank";
      msgBtn.rel = "noopener";
    }

    // Описание (если на странице его реально нет)
    const desc = String(expert.description||"").trim();
    if(desc){
      const alreadyHas = document.body && (document.body.innerText || "").includes(desc.slice(0, Math.min(25, desc.length)));
      if(!alreadyHas && !document.getElementById("aiDescBlock")){
        const block = document.createElement("div");
        block.id="aiDescBlock";
        block.className="h-card";
        block.style.marginTop="14px";
        block.innerHTML = `
          <h2 class="section-title" style="margin:0 0 8px">Описание</h2> <div class="section-sub" style="margin:0;white-space:pre-wrap">${desc.replace(/[&<>]/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[m]))}</div>
        `;
        (document.querySelector(".container") || host).appendChild(block);
      }
    }
  }

  /* ---------- run ---------- */
  function run(){
    enhanceRoleInput();

    // разбиваем теги несколько раз (быстро, без observer)
    splitCommaTagsOnce();
    setTimeout(splitCommaTagsOnce, 400);
    setTimeout(splitCommaTagsOnce, 1400);

    enhanceExpertPage();
  }

  if(document.readyState==="loading") document.addEventListener("DOMContentLoaded", run);
  else run();
})();
</script> <style>
/* =========================
   AI-Биржа • Lightbox + CARD thumbs
   ========================= */

/* 1) На CARD (страница карточки): превью БЕЗ ПОЛЕЙ */
html[data-ai-page="card"] #allrecords .ab-gallery-item,
html[data-ai-page="card"] .t-records .ab-gallery-item{
  position: relative;
  overflow: hidden;
  border-radius: 18px;
  background: transparent !important;
}

/* Дефолтный формат превью в галерее на CARD (можешь менять) */
html[data-ai-page="card"] #allrecords .ab-gallery-item{ aspect-ratio: 16 / 10; }
html[data-ai-page="card"] .t-records .ab-gallery-item{ aspect-ratio: 16 / 10; }

html[data-ai-page="card"] #allrecords .ab-gallery-item img,
html[data-ai-page="card"] #allrecords .ab-gallery-item video,
html[data-ai-page="card"] .t-records .ab-gallery-item img,
html[data-ai-page="card"] .t-records .ab-gallery-item video{
  width: 100% !important;
  height: 100% !important;
  object-fit: cover !important;      /* ВОТ ЭТО убирает поля */
  background: transparent !important; /* не рисуем черный фон */
  display:block;
}

/* Чтобы видео в превью не мешало клику (мы открываем лайтбокс) */
html[data-ai-page="card"] .ab-gallery-item video{
  pointer-events: none;
}

/* 2) Lightbox */
.ab-lb{
  position: fixed; inset: 0;
  z-index: 999999;
  background: rgba(10,20,40,.62);
  backdrop-filter: blur(8px);
  display: none;
  align-items: center;
  justify-content: center;
  padding: 18px;
}
.ab-lb.open{ display:flex; }

.ab-lb__inner{
  width: min(1080px, 96vw);
  max-height: 92vh;
  border-radius: 22px;
  overflow: hidden;
  background: rgba(255,255,255,.9);
  box-shadow: 0 20px 60px rgba(0,0,0,.25);
  position: relative;
}

.ab-lb__top{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding: 10px 12px;
  background: rgba(255,255,255,.85);
  border-bottom: 1px solid rgba(0,0,0,.06);
}

.ab-lb__title{
  font-size: 14px;
  color: rgba(20,35,63,.8);
  font-weight: 700;
  overflow:hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.ab-lb__close{
  border: none;
  border-radius: 14px;
  padding: 10px 12px;
  cursor: pointer;
  background: rgba(240,245,255,.9);
  box-shadow: inset 6px 6px 14px rgba(163,177,198,.25), inset -6px -6px 14px rgba(255,255,255,.9);
  font-weight: 900;
}

.ab-lb__stage{
  background: #0b0c10; /* фон для full-view */
  display:flex;
  align-items:center;
  justify-content:center;
  width: 100%;
  height: calc(92vh - 52px);
  max-height: calc(92vh - 52px);
  position: relative;
}

.ab-lb__stage img,
.ab-lb__stage video{
  max-width: 100%;
  max-height: 100%;
  width: auto;
  height: auto;
  object-fit: contain; /* В full-view НЕ режем */
  background: #000;
}

.ab-lb__nav{
  position:absolute;
  top: 50%;
  transform: translateY(-50%);
  width: 44px;
  height: 44px;
  border: none;
  border-radius: 16px;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  background: rgba(255,255,255,.88);
  box-shadow: 0 10px 30px rgba(0,0,0,.18);
  font-size: 20px;
  font-weight: 900;
  user-select:none;
}
.ab-lb__nav.prev{ left: 12px; }
.ab-lb__nav.next{ right: 12px; }

@media (max-width: 640px){
  .ab-lb__nav{ width: 40px; height: 40px; border-radius: 14px; }
  .ab-lb__stage{ height: calc(92vh - 52px); }
}
</style> <script>
(function(){
  /* -------------------------
     0) Определяем тип страницы
     ------------------------- */
  function detectPage(){
    const path = location.pathname.replace(/\/+$/,'');
    const qs = new URLSearchParams(location.search);

    // /add = кабинет/создание карточки (там нам НЕ надо cover)
    if(path === "/add") return "add";

    // CARD: у тебя это может быть /card или /profile и т.п.
    // Определим по наличию id и слова "Карточка исполнителя" на странице
    const hasId = qs.get("id") || qs.get("expert") || qs.get("expert_id");
    const hasCardTitle = Array.from(document.querySelectorAll("h1,h2,h3"))
      .some(h => /карточка исполнителя/i.test(h.textContent||""));
    if(hasId && hasCardTitle) return "card";

    return "other";
  }

  function setPageDataset(){
    document.documentElement.dataset.aiPage = detectPage();
  }

  /* -------------------------
     1) Находим галерею на CARD
     ------------------------- */
  function getGalleryRoot(){
    // если у тебя есть конкретный id — подхватим
    const byId = document.getElementById("galleryGrid") || document.getElementById("expertGallery") || document.getElementById("mediaGallery");
    if(byId) return byId;

    // ищем секцию, где заголовок "Галерея"
    const headings = Array.from(document.querySelectorAll("h2,h3"));
    const h = headings.find(x => (x.textContent||"").trim().toLowerCase() === "галерея");
    if(h){
      // обычно галерея рядом/ниже
      return h.closest(".h-card") || h.parentElement;
    }

    return null;
  }

  /* -------------------------
     2) Превращаем элементы в кликабельные items
     ------------------------- */
  function buildItems(root){
    // берём только внутри найденного блока
    const nodes = Array.from(root.querySelectorAll("img, video"));
    const items = [];

    nodes.forEach((el) => {
      const wrap = el.closest(".ab-gallery-item") || el.parentElement;

      // помечаем обёртку как элемент галереи (для CSS cover на CARD)
      if(wrap && !wrap.classList.contains("ab-gallery-item")){
        wrap.classList.add("ab-gallery-item");
        wrap.style.cursor = "pointer";
      }

      if(el.tagName.toLowerCase() === "img"){
        const src = el.currentSrc || el.src;
        if(src) items.push({ type:"img", src });
      } else {
        const src = el.currentSrc || el.src || (el.querySelector("source") ? el.querySelector("source").src : "");
        if(src) items.push({ type:"video", src });
      }
    });

    return items;
  }

  /* -------------------------
     3) Lightbox UI
     ------------------------- */
  function ensureLightbox(){
    let lb = document.getElementById("abLightbox");
    if(lb) return lb;

    lb = document.createElement("div");
    lb.id = "abLightbox";
    lb.className = "ab-lb";
    lb.innerHTML = `
      <div class="ab-lb__inner" role="dialog" aria-modal="true"> <div class="ab-lb__top"> <div class="ab-lb__title" id="abLbTitle">Просмотр</div> <button class="ab-lb__close" type="button" id="abLbClose">✕</button> </div> <div class="ab-lb__stage" id="abLbStage"> <button class="ab-lb__nav prev" type="button" id="abLbPrev" aria-label="Предыдущее">‹</button> <button class="ab-lb__nav next" type="button" id="abLbNext" aria-label="Следующее">›</button> </div> </div>
    `;
    document.body.appendChild(lb);
    return lb;
  }

  function openLb(state, index){
    const lb = ensureLightbox();
    const stage = lb.querySelector("#abLbStage");
    const title = lb.querySelector("#abLbTitle");
    const items = state.items;

    state.index = (index + items.length) % items.length;

    // чистим старый контент (кроме кнопок навигации)
    Array.from(stage.children).forEach(ch=>{
      if(ch.id === "abLbPrev" || ch.id === "abLbNext") return;
      ch.remove();
    });

    const cur = items[state.index];
    title.textContent = (state.index + 1) + " / " + items.length;

    if(cur.type === "img"){
      const img = document.createElement("img");
      img.src = cur.src;
      img.alt = "";
      stage.appendChild(img);
    } else {
      const v = document.createElement("video");
      v.src = cur.src;
      v.controls = true;
      v.autoplay = true;
      v.playsInline = true;
      v.preload = "metadata";
      stage.appendChild(v);
    }

    lb.classList.add("open");
    document.body.style.overflow = "hidden";
  }

  function closeLb(){
    const lb = document.getElementById("abLightbox");
    if(!lb) return;
    lb.classList.remove("open");
    document.body.style.overflow = "";
  }

  /* -------------------------
     4) Swipe на мобиле
     ------------------------- */
  function enableSwipe(stage, onPrev, onNext){
    let x0 = null, y0 = null;
    stage.addEventListener("touchstart", (e)=>{
      const t = e.touches[0];
      x0 = t.clientX; y0 = t.clientY;
    }, {passive:true});

    stage.addEventListener("touchend", (e)=>{
      if(x0===null) return;
      const t = e.changedTouches[0];
      const dx = t.clientX - x0;
      const dy = t.clientY - y0;
      x0 = null; y0 = null;

      if(Math.abs(dx) > 40 && Math.abs(dx) > Math.abs(dy)){
        if(dx > 0) onPrev();
        else onNext();
      }
    }, {passive:true});
  }

  /* -------------------------
     5) Init
     ------------------------- */
  function init(){
    setPageDataset();
    if(document.documentElement.dataset.aiPage !== "card") return;

    const root = getGalleryRoot();
    if(!root) return;

    const items = buildItems(root);
    if(items.length === 0) return;

    const state = { items, index: 0 };

    // клики по любому img/video в галерее → открыть
    root.addEventListener("click", (e)=>{
      const el = e.target.closest("img, video");
      if(!el) return;

      const src = el.currentSrc || el.src || (el.querySelector && el.querySelector("source") ? el.querySelector("source").src : "");
      const idx = state.items.findIndex(x => x.src === src);
      openLb(state, idx >= 0 ? idx : 0);
    });

    // навигация/закрытие
    const lb = ensureLightbox();
    const prev = lb.querySelector("#abLbPrev");
    const next = lb.querySelector("#abLbNext");
    const close = lb.querySelector("#abLbClose");
    const stage = lb.querySelector("#abLbStage");

    function goPrev(){ openLb(state, state.index - 1); }
    function goNext(){ openLb(state, state.index + 1); }

    prev.onclick = goPrev;
    next.onclick = goNext;
    close.onclick = closeLb;

    // клик по фону закрывает
    lb.addEventListener("click", (e)=>{
      if(e.target === lb) closeLb();
    });

    // клавиши
    document.addEventListener("keydown", (e)=>{
      const opened = lb.classList.contains("open");
      if(!opened) return;
      if(e.key === "Escape") closeLb();
      if(e.key === "ArrowLeft") goPrev();
      if(e.key === "ArrowRight") goNext();
    });

    enableSwipe(stage, goPrev, goNext);
  }

  if(document.readyState === "loading") document.addEventListener("DOMContentLoaded", init);
  else init();

  // Подстраховка: Tilda иногда дорисовывает блоки позже
  setTimeout(()=>{ try{ init(); }catch(e){} }, 600);
  setTimeout(()=>{ try{ init(); }catch(e){} }, 1600);
})();
</script> <style>
  /* скрываем карточку "Что внутри" */
  .ai-hide-what-inside{display:none!important;}

  /* если в hero-grid осталась одна карточка — делаем 1 колонку */
  .hero-grid.ai-hero-onecol{grid-template-columns:1fr!important;}
</style> <script>
(function () {
  function norm(s){ return (s||'').replace(/\s+/g,' ').trim().toLowerCase(); }

  function hideFrom(el){
    const card =
      el.closest('.h-card') ||
      el.closest('.t-rec') ||
      el.closest('#allrecords > div') ||
      el.parentElement;

    if(card){
      card.classList.add('ai-hide-what-inside');

      // если это правая карточка в hero-grid — растягиваем левую
      const grid = card.closest('.hero-grid');
      if(grid){
        const visible = Array.from(grid.querySelectorAll('.h-card'))
          .filter(c => !c.classList.contains('ai-hide-what-inside'));
        if(visible.length <= 1) grid.classList.add('ai-hero-onecol');
      }
    }
  }

  function run(){
    // 1) ищем по заголовку "Что внутри"
    document.querySelectorAll('h1,h2,h3').forEach(function(h){
      if(norm(h.textContent) === 'что внутри') hideFrom(h);
    });

    // 2) fallback: ищем карточки с бейджем "MVP" и заголовком "Что внутри"
    document.querySelectorAll('.badge').forEach(function(b){
      if(norm(b.textContent) === 'mvp'){
        const card = b.closest('.h-card');
        if(!card) return;
        const h = card.querySelector('h1,h2,h3');
        if(h && norm(h.textContent) === 'что внутри'){
          card.classList.add('ai-hide-what-inside');
          const grid = card.closest('.hero-grid');
          if(grid) grid.classList.add('ai-hero-onecol');
        }
      }
    });
  }

  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', run);
  } else {
    run();
  }
})();
</script> <script>
(function () {
  if (window.__AI_ALBUMS_FORCE_V1__) return;
  window.__AI_ALBUMS_FORCE_V1__ = true;

  function onReady(fn){
    if(document.readyState === 'loading') document.addEventListener('DOMContentLoaded', fn);
    else fn();
  }

  function loadScript(src){
    return new Promise((resolve, reject)=>{
      const s = document.createElement('script');
      s.src = src; s.async = true;
      s.onload = resolve; s.onerror = reject;
      document.head.appendChild(s);
    });
  }

  async function getSB(){
    // 1) если уже есть — ок
    if (window.AI_BIRZHA && window.AI_BIRZHA.sb) return window.AI_BIRZHA.sb;

    // 2) проверяем конфиг
    if (!window.AI_BIRZHA || !window.AI_BIRZHA.SUPABASE_URL || !window.AI_BIRZHA.SUPABASE_ANON_KEY) {
      console.warn('[ALBUMS] Нет window.AI_BIRZHA.SUPABASE_URL / ANON_KEY');
      return null;
    }

    // 3) если supabase-js не подключён — подключаем
    if (!window.supabase) {
      await loadScript('https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2');
    }

    // 4) создаём клиент
    window.AI_BIRZHA.sb = window.supabase.createClient(
      window.AI_BIRZHA.SUPABASE_URL,
      window.AI_BIRZHA.SUPABASE_ANON_KEY
    );
    return window.AI_BIRZHA.sb;
  }

  function mountAlbumsUI(){
    // показываем ТОЛЬКО на /add
    if (!location.pathname.includes('/add')) return;
    if (document.getElementById('aiAlbumsAdd')) return;

    const host =
      document.querySelector('.h-card') ||
      document.querySelector('#allrecords') ||
      document.querySelector('.t-records') ||
      document.body;

    const box = document.createElement('div');
    box.className = 'h-card';
    box.id = 'aiAlbumsAdd';
    box.style.marginTop = '16px';
    box.innerHTML = `
      <div class="h-eyebrow">Портфолио</div> <h2 class="section-title" style="margin:8px 0 0">Альбомы</h2> <p class="section-sub" style="margin:8px 0 0">Создай альбом (например “Рилсы”) и добавляй медиа в него.</p> <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:end;margin-top:12px"> <div style="flex:1 1 240px"> <label>Название альбома</label> <input id="aiAlbumTitle" type="text" placeholder="Рилсы" /> </div> <button class="btn primary" type="button" id="aiAlbumCreate">Создать альбом</button> </div> <div class="small" id="aiAlbumsStatus" style="margin-top:10px"></div>
    `;

    // вставим после первого .h-card (а не “внутрь”), чтобы точно было видно
    if (host.classList && host.classList.contains('h-card')) host.insertAdjacentElement('afterend', box);
    else host.appendChild(box);
  }

  onReady(async function(){
    // 1) принудительно вставляем UI (кнопка появится сразу)
    mountAlbumsUI();

    // 2) подключаем Supabase и делаем кнопку рабочей
    const sb = await getSB();
    const status = document.getElementById('aiAlbumsStatus');
    const btn = document.getElementById('aiAlbumCreate');
    const title = document.getElementById('aiAlbumTitle');

    if (!status || !btn || !title) return;

    if (!sb) {
      status.textContent = 'Ошибка: Supabase не подключился. Проверь, что в HEAD есть window.AI_BIRZHA (URL + KEY).';
      return;
    }

    const { data: authData } = await sb.auth.getUser();
    const user = authData?.user;
    if (!user) {
      status.textContent = 'Войди в аккаунт, чтобы создавать альбомы.';
      btn.disabled = true;
      return;
    }

    // найдём expert_id
    const ex = await sb.from('experts').select('id').eq('user_id', user.id).limit(1);
    const expertId = ex?.data?.[0]?.id;
    if (!expertId) {
      status.textContent = 'Сначала нажми “Сохранить” карточку. Потом создавай альбомы.';
      btn.disabled = true;
      return;
    }

    btn.addEventListener('click', async function(){
      const t = (title.value || '').trim();
      if(!t) return alert('Напиши название альбома.');

      status.textContent = 'Создаю альбом...';
      const r = await sb.from('expert_albums').insert({
        expert_id: expertId,
        user_id: user.id,
        title: t
      }).select('id,title');

      if (r.error){
        status.textContent = 'Ошибка: ' + r.error.message;
        return;
      }

      status.textContent = 'Готово ✅ Альбом создан: ' + (r.data?.[0]?.title || t);
      title.value = '';
    });
  });

})();
</script> <!-- nominify end --><!-- nominify begin --><style>
.hero-grid--single{ grid-template-columns: 1fr !important; }
</style><!-- nominify end --><script type="text/javascript">window.dataLayer=window.dataLayer||[];</script> <script type="text/javascript">(function() {if((/bot|google|yandex|baidu|bing|msn|duckduckbot|teoma|slurp|crawler|spider|robot|crawling|facebook/i.test(navigator.userAgent))===false&&typeof(sessionStorage)!='undefined'&&sessionStorage.getItem('visited')!=='y'&&document.visibilityState){var style=document.createElement('style');style.type='text/css';style.innerHTML='@media screen and (min-width: 980px) {.t-records {opacity: 0;}.t-records_animated {-webkit-transition: opacity ease-in-out .2s;-moz-transition: opacity ease-in-out .2s;-o-transition: opacity ease-in-out .2s;transition: opacity ease-in-out .2s;}.t-records.t-records_visible {opacity: 1;}}';document.getElementsByTagName('head')[0].appendChild(style);function t_setvisRecs(){var alr=document.querySelectorAll('.t-records');Array.prototype.forEach.call(alr,function(el) {el.classList.add("t-records_animated");});setTimeout(function() {Array.prototype.forEach.call(alr,function(el) {el.classList.add("t-records_visible");});sessionStorage.setItem("visited","y");},400);}
document.addEventListener('DOMContentLoaded',t_setvisRecs);}})();</script><script id="ai-remove-tilda">
(function(){
  function rm(){
    try{
      var el = document.getElementById("tildacopy");
      if(el) el.remove();
      document.querySelectorAll(".t-tildalabel").forEach(function(x){
        try{ x.remove(); }catch(e){}
      });
    }catch(e){}
  }
  try{
    var mo = new MutationObserver(function(){ rm(); });
    mo.observe(document.documentElement, { childList:true, subtree:true });
  }catch(e){}
  rm();
  document.addEventListener("DOMContentLoaded", rm);
  window.addEventListener("load", rm);
  setTimeout(rm, 50);
  setTimeout(rm, 250);
})();
</script><style id="ai-logo-css">
  /* ЛОГО: /images/ai-logo.png + запасной градиент */
  .nav a.brand{
    display:flex !important;
    align-items:center !important;
    gap:10px !important;
    text-decoration:none !important;
  }
  .nav a.brand .logo{
    width: 36px !important;
    height: 36px !important;
    flex: 0 0 auto !important;
    border-radius: 999px !important;
    background:
      url("/images/ai-logo.png") center / cover no-repeat,
      linear-gradient(135deg, #1E78FF 0%, #00B7FF 100%) !important;
  }
  /* Мобильный хедер: точно такой же как в gallery.html */
  @media (max-width: 560px){
    .nav a.brand{ flex: 0 0 auto !important; min-width: auto !important; }
    .nav a.brand span:not(.logo){display:block !important;font-size:12px !important;font-weight:700 !important;white-space:nowrap !important;}
    .nav a.brand .logo{ width: 34px !important; height: 34px !important; }
    .nav .nav-cta{ flex-wrap: wrap !important; justify-content: flex-end; }
  }
</style><link rel="stylesheet" href="/css/mobile-menu.css?v=20260104c7">
</head> <body class="t-body" style="margin:0;"> <!--allrecords--> <div id="allrecords" data-tilda-export="yes" class="t-records" data-hook="blocks-collection-content-node" data-tilda-project-id="13172919" data-tilda-page-id="103811056" data-tilda-page-alias="experts" data-tilda-formskey="77f9e6caf19eb935e0f8ff1513172919" data-tilda-cookie="no" data-tilda-lazy="yes" data-tilda-root-zone="com" data-tilda-project-headcode="yes" data-tilda-page-headcode="yes" data-tilda-project-country="RU"> <div id="rec1689486501" class="r t-rec" style=" " data-animationappear="off" data-record-type="131"> <!-- T123 --> <div class="t123"> <div class="t-container_100 "> <div class="t-width t-width_100 "> <!-- nominify begin --> <!-- ====== PAGE: Исполнители (ONE-PASTE, FULL) ====== --> <header class="nav"> <div class="container nav-inner"> <a class="brand" href="/"> <span class="logo" aria-hidden="true"></span> <span>Маркетплейс ИИ услуг</span> </a> <nav class="nav-links" aria-label="Навигация"> <a href="/projects.html">Проекты</a> <a href="/experts">Исполнители</a> <a href="/gallery.html">Галерея работ</a> <a href="/how">Как это работает</a> <a href="/faq">FAQ</a> </nav> <div class="nav-cta"> <a class="btn" href="/add">Разместить услугу</a> <a class="btn primary" href="/apply">Оставить заявку</a> </div> </div> </header> <main> <!-- ФИЛЬТР НИШ --> <section class="section" id="experts-filter"> <div class="container"> <div class="h-card"> <div class="h-eyebrow">Фильтр</div> <h1 class="h-title" style="font-size:34px">Выбери нишу исполнителей</h1> <p class="h-sub">Одна ниша за раз. Можно сбросить фильтр и снова увидеть всех.</p> <div class="pick-grid cat-picker"> <button class="pick-btn" type="button" data-cat="video"><span class="ico" aria-hidden="true">&#127916;</span> AI-Видео</button> <button class="pick-btn" type="button" data-cat="design"><span class="ico" aria-hidden="true">&#127912;</span> AI-Дизайн</button> <button class="pick-btn" type="button" data-cat="bots"><span class="ico" aria-hidden="true">&#129302;</span> AI-Боты</button> <button class="pick-btn" type="button" data-cat="marketplaces"><span class="ico" aria-hidden="true">&#128722;</span> WB/Ozon</button> <button class="pick-btn" type="button" data-cat="sites"><span class="ico" aria-hidden="true">&#129513;</span> AI-Сайты</button> <button class="pick-btn ghost" type="button" data-cat="">Сбросить</button> </div> </div> </div> </section> <!-- HERO --> <section class="hero"> <div class="container hero-grid hero-grid--single"> <div class="h-card"> <div class="h-eyebrow">Каталог</div> <h1 class="h-title">Исполнители</h1> <p class="h-sub">Ищи по задаче или выбери нишу сверху. Превью берётся из выбранной обложки в карточке.</p> <div class="searchbox"> <form data-search style="display:flex;gap:10px;flex:1;flex-wrap:wrap"> <input name="q" placeholder="Например: 10 reels для стоматологии / карточка WB / бот в Telegram" /> <button class="btn primary" type="submit">Подобрать исполнителя</button> </form> </div> <div class="h-actions"> <a class="btn primary" href="/add">Добавить исполнителя</a> <a class="btn" href="/apply">Оставить заявку</a> </div> <div class="note">Без оплат на сайте. Договорённости напрямую.</div> </div> </div> </div> </div> </section> <!-- СПИСОК --> <section class="section" id="experts-list"> <div class="container"> <h2 class="section-title">Список исполнителей</h2> <p class="section-sub">Клик по карточке → открывается страница исполнителя.</p> <div class="grid" id="expertsGrid"></div> <div class="small" id="expertsMsg" style="margin-top:10px"></div> </div> </section> </main> <style>
/* Белый текст на синем ВЕЗДЕ */
.btn.primary, .btn.primary *{ color:#fff !important; }
.badge, .badge *{ color:#fff !important; }
.pick-btn.active, .pick-btn.active *{ color:#fff !important; }

/* кнопки ниш */
.pick-grid{ display:grid; grid-template-columns: repeat(6, minmax(0, 1fr)); gap:12px; margin-top:12px; }
@media (max-width: 980px){ .pick-grid{ grid-template-columns: repeat(3, minmax(0, 1fr)); } }
@media (max-width: 560px){ .pick-grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); } }

.pick-btn{
  width:100%;
  border:1px solid rgba(255,255,255,.75);
  border-radius:18px;
  padding:14px 12px;
  background: var(--surface);
  color: var(--text);
  font-weight:900;
  cursor:pointer;
  box-shadow: 10px 10px 22px rgba(163,177,198,.45), -10px -10px 22px rgba(255,255,255,.92);
  transition:.15s transform ease, .15s box-shadow ease;
}
.pick-btn:hover{ transform: translateY(-1px); }
.pick-btn:active{
  transform: translateY(0);
  box-shadow: inset 10px 10px 22px rgba(163,177,198,.45), inset -10px -10px 22px rgba(255,255,255,.92);
}
.pick-btn.active{ background: var(--accent-grad); }
.ico{ font-size:18px; line-height:1; }

/* карточки */
.expert-card{ cursor:pointer; }
.expert-cover{
  width:100%;
  aspect-ratio: 16/10;
  border-radius: 18px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,.7);
  background: linear-gradient(135deg, rgba(30,120,255,.12), rgba(0,183,255,.10));
  box-shadow: inset 10px 10px 22px rgba(163,177,198,.25), inset -10px -10px 22px rgba(255,255,255,.85);
  margin-bottom:10px;
}
.expert-cover img, .expert-cover video{ width:100%; height:100%; object-fit:cover; display:block; }
.expert-cover .ph{
  width:100%;height:100%;
  display:flex;align-items:center;justify-content:center;
  color: rgba(19,35,63,.55);
  font-weight:900;
}
.expert-short{
  margin-top:6px;
  padding:10px;
  border-radius: 16px;
  border:1px solid rgba(255,255,255,.7);
  background: rgba(255,255,255,.35);
  box-shadow: inset 10px 10px 22px rgba(163,177,198,.20), inset -10px -10px 22px rgba(255,255,255,.85);
}
.expert-short-label{ font-weight:900; margin-bottom:4px; }
.expert-short-text{ color: var(--muted); line-height:1.4; font-size:14px; }
.expert-actions{ margin-top:12px; display:flex; gap:10px; flex-wrap:wrap; }
</style> <script>
window.addEventListener('DOMContentLoaded', function () {
  const BUCKET = "experts-media";
  const PROFILE_PATH = "/card"; // ✅ профиль у нас /card?id=...

  const CAT_LABEL = {
    video: "AI-Видео",
    design: "AI-Дизайн",
    bots: "AI-Боты",
    marketplaces: "WB/Ozon",
    sites: "AI-Сайты"
  };

  const grid = document.getElementById('expertsGrid');
  const msg  = document.getElementById('expertsMsg');

  function esc(s){
    return String(s || "").replace(/[&<>"']/g, m => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    }[m]));
  }
  function escAttr(s){ return esc(s).replace(/"/g, "&quot;"); }

  async function waitSb(){
    for(let i=0;i<40;i++){
      if(window.AI_BIRZHA && window.AI_BIRZHA.sb) return window.AI_BIRZHA.sb;
      await new Promise(r => setTimeout(r,150));
    }
    return null;
  }

  function buildTelegramLink(raw){
    if(!raw) return null;
    const t = raw.trim();
    if(!t) return null;
    if(t.startsWith("@")) return "https://t.me/" + t.slice(1);
    if(t.includes("t.me/")) return t;
    return null;
  }

  function setActiveButton(cat){
    document.querySelectorAll('.cat-picker [data-cat]').forEach(btn => {
      btn.classList.toggle('active', !!cat && btn.dataset.cat === cat);
    });
  }
  function setUrlCat(cat){
    const u = new URL(location.href);
    if (cat) u.searchParams.set('cat', cat);
    else u.searchParams.delete('cat');
    history.replaceState(null, "", u.toString());
  }

  async function loadExperts(cat){
    msg.textContent = "Загружаю исполнителей...";
    grid.innerHTML = "";

    const sb = await waitSb();
    if(!sb){ msg.textContent = "Supabase не подключен."; return; }

    let q = sb
      .from("experts")
      .select("id, category, name, role, short_info, price_from, delivery_time, telegram, cover_path, cover_type, status, created_at")
      .eq("status", "approved")
      .order("created_at", { ascending:false })
      .limit(60);

    if (cat) q = q.eq("category", cat);

    const { data, error } = await q;
    if(error){ msg.textContent = "Ошибка загрузки: " + error.message; return; }
    if(!data || data.length===0){
      msg.textContent = cat ? "В этой нише пока нет одобренных исполнителей." : "Пока нет одобренных исполнителей.";
      return;
    }

    const paths = data.map(x => x.cover_path).filter(Boolean);
    const urlByPath = new Map();
    if(paths.length){
      const { data: sdata } = await sb.storage.from(BUCKET).createSignedUrls(paths, 60*60);
      (sdata || []).forEach(it => { if(it?.path && it?.signedUrl) urlByPath.set(it.path, it.signedUrl); });
    }

    grid.innerHTML = data.map(x => {
      const coverUrl  = x.cover_path ? (urlByPath.get(x.cover_path) || "") : "";
      const coverType = String(x.cover_type||"").toLowerCase();
      const profileHref = PROFILE_PATH + "?id=" + encodeURIComponent(x.id);

      const tg = buildTelegramLink(x.telegram || "");
      const shortText = x.short_info || "—";

      const coverHtml = coverUrl
        ? (coverType === "video"
            ? `<div class="expert-cover"><video src="${escAttr(coverUrl)}" muted playsinline preload="metadata"></video></div>`
            : `<div class="expert-cover"><img src="${escAttr(coverUrl)}" alt=""></div>`
          )
        : `<div class="expert-cover"><div class="ph">PREVIEW</div></div>`;

      return `
        <div class="card expert-card" data-open="${escAttr(profileHref)}" tabindex="0" role="link">
          ${coverHtml}

          <h3>${esc(x.name)} • ${esc(CAT_LABEL[x.category] || x.category)}</h3> <div class="expert-short"> <div class="expert-short-label">Краткая информация</div> <div class="expert-short-text">${esc(shortText)}</div> </div> <div class="tagrow" style="margin-top:10px">
            ${x.price_from ? `<span class="tag">${esc(x.price_from)}</span>` : ``}
            ${x.delivery_time ? `<span class="tag">${esc(x.delivery_time)}</span>` : ``}
            ${x.role ? `<span class="tag">${esc(x.role)}</span>` : ``}
          </div> <div class="expert-actions"> <button class="btn primary open-card" type="button" data-href="${escAttr(profileHref)}">Открыть карточку</button>
            ${tg ? `<a class="btn tg-link" href="${escAttr(tg)}" target="_blank" rel="noopener">Написать сообщение</a>` : `<span class="btn" style="opacity:.55;cursor:not-allowed">Нет Telegram</span>`}
          </div> </div>
      `;
    }).join("");

    grid.querySelectorAll(".expert-card").forEach(card => {
      const href = card.getAttribute("data-open");
      card.addEventListener("click", () => { 
        if (window.navigateTo) {
          window.navigateTo(href);
        } else {
          location.href = href;
        }
      });
      card.addEventListener("keydown", (e) => {
        if(e.key === "Enter" || e.key === " ") { 
          e.preventDefault(); 
          if (window.navigateTo) {
            window.navigateTo(href);
          } else {
            location.href = href;
          }
        }
      });
    });
    grid.querySelectorAll(".tg-link").forEach(a => a.addEventListener("click", (e) => e.stopPropagation()));
    grid.querySelectorAll(".open-card").forEach(b => b.addEventListener("click", (e) => { 
      e.stopPropagation(); 
      if (window.navigateTo) {
        window.navigateTo(b.dataset.href);
      } else {
        location.href = b.dataset.href;
      }
    }));

    msg.textContent = "";
  }

  // фильтр
  document.querySelectorAll(".cat-picker [data-cat]").forEach(btn => {
    btn.addEventListener("click", function(){
      const cat = btn.dataset.cat || "";
      setActiveButton(cat);
      setUrlCat(cat);
      loadExperts(cat);
    });
  });

  // поиск -> открывает модальное окно умного поиска
  const sform2 = document.querySelector('form[data-search]');
  if (sform2 && !sform2.dataset.searchBound) {
    sform2.dataset.searchBound = '1';
    sform2.addEventListener('submit', function (e) {
      e.preventDefault();
      const input = sform2.querySelector('input[name="q"]');
      const q = input ? input.value.trim() : '';
      if (!q) {
        alert('Введите запрос для поиска');
        return;
      }
      if (typeof window.openSearchModal === 'function') {
        window.openSearchModal(q);
      } else {
        location.href = "/apply?q=" + encodeURIComponent(q);
      }
    });
  }

  const qs = new URLSearchParams(location.search);
  const startCat = qs.get("cat") || "";
  setActiveButton(startCat);
  loadExperts(startCat);
});
</script> <style>
/* ===== MINI-CAROUSEL inside .expert-cover on /experts (v2) ===== */
.expert-cover{ position:relative; }
.expert-cover[data-mc="1"]{ cursor:grab; }
.expert-cover[data-mc="1"]:active{ cursor:grabbing; }

.mc{ position:absolute; inset:0; z-index:2; }
.mc-track{ position:absolute; inset:0; z-index:1; }
.mc-item{ position:absolute; inset:0; opacity:0; transition:opacity .18s ease; }
.mc-item.active{ opacity:1; }

.mc-item img, .mc-item video{
  width:100%; height:100%;
  object-fit:contain; /* НЕ режем вертикальные */
  display:block;
  background: linear-gradient(135deg, rgba(30,120,255,.10), rgba(0,183,255,.08));
}

/* чтобы кнопки точно были кликабельны */
.mc-btn{
  position:absolute; top:50%; transform:translateY(-50%);
  width:40px; height:40px; border-radius:14px;
  border:1px solid rgba(255,255,255,.75);
  background: rgba(238,243,250,.78);
  backdrop-filter: blur(10px);
  box-shadow: 10px 10px 22px rgba(163,177,198,.35), -10px -10px 22px rgba(255,255,255,.92);
  cursor:pointer;
  z-index:5;
  pointer-events:auto;
  user-select:none;
}
.mc-prev{ left:10px; }
.mc-next{ right:10px; }

@media (max-width:560px){
  .mc-btn{ width:36px; height:36px; }
}

.mc-dots{
  position:absolute; left:50%; bottom:10px; transform:translateX(-50%);
  display:flex; gap:6px; padding:6px 10px; border-radius:999px;
  border:1px solid rgba(255,255,255,.65);
  background: rgba(238,243,250,.65);
  backdrop-filter: blur(10px);
  box-shadow: 10px 10px 22px rgba(163,177,198,.20), -10px -10px 22px rgba(255,255,255,.85);
  z-index:5;
  pointer-events:auto;
}
.mc-dot{ width:8px; height:8px; border-radius:999px; background: rgba(19,35,63,.25); }
.mc-dot.active{ background: rgba(30,120,255,.95); }
</style> <script>
(function(){
  const BUCKET = "experts-media"; // проверь bucket

  function waitSb(){
    return new Promise(async (resolve) => {
      for(let i=0;i<60;i++){
        if(window.AI_BIRZHA && window.AI_BIRZHA.sb) return resolve(window.AI_BIRZHA.sb);
        await new Promise(r=>setTimeout(r,150));
      }
      resolve(null);
    });
  }

  function parseExpertIdFromCard(card){
    const href = card.getAttribute("data-open")
      || card.querySelector(".open-card")?.dataset?.href
      || "";
    try{
      const u = new URL(href, location.origin);
      return u.searchParams.get("id");
    }catch(e){ return null; }
  }

  const uniq = (arr)=>{ const s=new Set(),o=[]; for(const x of arr){ if(x && !s.has(x)){s.add(x);o.push(x)} } return o; };

  function pauseAllVideos(root){
    root.querySelectorAll("video").forEach(v=>{ try{ v.pause(); v.currentTime = 0; }catch(e){} });
  }

  function makeCarousel(coverEl, slides){
    if(!slides || slides.length < 2) return;

    coverEl.dataset.mc = "1";

    // если в карточке есть общий клик на открытие — не даём ему срабатывать от превью
    coverEl.addEventListener("click", (e)=>{ e.stopPropagation(); }, true);

    coverEl.innerHTML = `
      <div class="mc"> <div class="mc-track"></div> <button class="mc-btn mc-prev" type="button" aria-label="Назад">‹</button> <button class="mc-btn mc-next" type="button" aria-label="Вперёд">›</button> <div class="mc-dots"></div> </div>
    `;

    const track = coverEl.querySelector(".mc-track");
    const prevB = coverEl.querySelector(".mc-prev");
    const nextB = coverEl.querySelector(".mc-next");
    const dots  = coverEl.querySelector(".mc-dots");

    let idx = 0;

    const items = slides.map((s, i) => {
      const wrap = document.createElement("div");
      wrap.className = "mc-item" + (i===0 ? " active" : "");

      if(String(s.type).toLowerCase() === "video"){
        const v = document.createElement("video");
        v.src = s.url;
        v.muted = true;
        v.playsInline = true;
        v.preload = "metadata";
        // тап по видео = play/pause (и не открывать карточку)
        v.addEventListener("click", (e)=>{ e.stopPropagation(); try{ v.paused ? v.play() : v.pause(); }catch(_){} }, true);
        wrap.appendChild(v);
      }else{
        const img = document.createElement("img");
        img.src = s.url;
        img.alt = "";
        wrap.appendChild(img);
      }

      track.appendChild(wrap);

      const d = document.createElement("div");
      d.className = "mc-dot" + (i===0 ? " active" : "");
      d.addEventListener("click", (e)=>{ e.stopPropagation(); go(i); }, true);
      dots.appendChild(d);

      return wrap;
    });

    function go(next){
      if(next === idx) return;
      pauseAllVideos(track);
      items[idx].classList.remove("active");
      dots.children[idx].classList.remove("active");

      idx = (next + items.length) % items.length;

      items[idx].classList.add("active");
      dots.children[idx].classList.add("active");
    }
    const next = ()=>go(idx+1);
    const prev = ()=>go(idx-1);

    // ФИКС: стрелки 100% кликабельны (ПК)
    ["pointerdown","click"].forEach(evt=>{
      prevB.addEventListener(evt, (e)=>{ e.preventDefault(); e.stopPropagation(); prev(); }, true);
      nextB.addEventListener(evt, (e)=>{ e.preventDefault(); e.stopPropagation(); next(); }, true);
    });

    // swipe (touch + pointer для всех устройств)
    let sx=0, sy=0, swiping=false;
    
    function handleStart(x, y){
      swiping = true;
      sx = x;
      sy = y;
    }
    function handleEnd(x, y){
      if(!swiping) return;
      swiping = false;
      const dx = x - sx;
      const dy = y - sy;
      if(Math.abs(dx) > 30 && Math.abs(dx) > Math.abs(dy)){
        dx < 0 ? next() : prev();
      }
    }
    
    // Touch events (мобильные)
    coverEl.addEventListener("touchstart", (e)=>{
      if(e.touches.length === 1){
        handleStart(e.touches[0].clientX, e.touches[0].clientY);
      }
    }, {passive:true});
    coverEl.addEventListener("touchend", (e)=>{
      if(e.changedTouches.length === 1){
        handleEnd(e.changedTouches[0].clientX, e.changedTouches[0].clientY);
      }
    }, {passive:true});
    
    // Pointer events (ПК, stylus)
    coverEl.addEventListener("pointerdown", (e)=>{
      if(e.pointerType !== "touch") handleStart(e.clientX, e.clientY);
    }, {passive:true});
    coverEl.addEventListener("pointerup", (e)=>{
      if(e.pointerType !== "touch") handleEnd(e.clientX, e.clientY);
    }, {passive:true});

    coverEl.addEventListener("pointercancel", ()=>{ down=false; }, {passive:true});

    // Моб: тап по левой/правой половине превью (кроме кнопок/точек/видео)
    coverEl.addEventListener("click", (e)=>{
      if(e.target.closest(".mc-btn, .mc-dots, video")) return;
      const r = coverEl.getBoundingClientRect();
      const x = e.clientX - r.left;
      (x < r.width/2) ? prev() : next();
    }, true);
  }

  window.addEventListener("DOMContentLoaded", async ()=>{
    const sb = await waitSb();
    const grid = document.getElementById("expertsGrid");
    if(!sb || !grid) return;

    const cache = new Map(); // expertId -> slides

    let t=null;
    const schedule = ()=>{ clearTimeout(t); t=setTimeout(enhance, 180); };

    new MutationObserver(schedule).observe(grid, { childList:true, subtree:true });
    schedule();

    async function enhance(){
      const cards = Array.from(grid.querySelectorAll(".expert-card"));
      if(!cards.length) return;

      const needIds = [];
      const idToCards = new Map();

      for(const card of cards){
        const id = parseExpertIdFromCard(card);
        if(!id) continue;
        if(!idToCards.has(id)) idToCards.set(id, []);
        idToCards.get(id).push(card);
        if(!cache.has(id)) needIds.push(id);
      }

      if(needIds.length){
        const { data: rows, error } = await sb
          .from("expert_media")
          .select("expert_id, media_type, storage_path, is_cover, created_at")
          .in("expert_id", uniq(needIds))
          .order("is_cover", { ascending:false })
          .order("created_at", { ascending:false })
          .limit(600);

        if(!error && rows?.length){
          const allPaths = uniq(rows.map(r=>r.storage_path).filter(Boolean));
          const urlByPath = new Map();

          if(allPaths.length){
            const { data: sdata } = await sb.storage.from(BUCKET).createSignedUrls(allPaths, 60*60);
            (sdata||[]).forEach(x=>{ if(x?.path && x?.signedUrl) urlByPath.set(x.path, x.signedUrl); });
          }

          const by = new Map();
          rows.forEach(r=>{
            if(!r.storage_path) return;
            if(!by.has(r.expert_id)) by.set(r.expert_id, []);
            by.get(r.expert_id).push(r);
          });

          for(const id of uniq(needIds)){
            const list = (by.get(id) || [])
              .map(r=>({
                type: (String(r.media_type||"").toLowerCase()==="video") ? "video" : "image",
                url: urlByPath.get(r.storage_path) || ""
              }))
              .filter(x=>x.url)
              .slice(0, 6); // можно 5-6 работ в превью
            cache.set(id, list);
          }
        }
      }

      for(const [id, listCards] of idToCards.entries()){
        const slides = cache.get(id) || [];
        if(slides.length < 2) continue;

        listCards.forEach(card=>{
          const cover = card.querySelector(".expert-cover");
          if(!cover || cover.dataset.mcDone==="1") return;
          cover.dataset.mcDone="1";
          makeCarousel(cover, slides);
        });
      }
    }
  });
})();
</script> <!-- ====== END PAGE ====== --> <!-- nominify end --> </div> </div> </div> </div> </div> <!--/allrecords--> <!-- Tilda copyright. Don't remove this line --><div class="t-tildalabel " id="tildacopy" data-tilda-sign="13172919#103811056"><a href="https://tilda.cc/" class="t-tildalabel__link"><div class="t-tildalabel__wrapper"><div class="t-tildalabel__txtleft">Made on </div><div class="t-tildalabel__wrapimg"><img src="images/tildacopy.png" class="t-tildalabel__img" fetchpriority="low" alt=""></div><div class="t-tildalabel__txtright">Tilda</div></div></a></div> <!-- Stat --> <script type="text/javascript">if(!window.mainTracker) {window.mainTracker='tilda';}
window.tildastatcookie='no';setTimeout(function(){(function(d,w,k,o,g) {var n=d.getElementsByTagName(o)[0],s=d.createElement(o),f=function(){n.parentNode.insertBefore(s,n);};s.type="text/javascript";s.async=true;s.key=k;s.id="tildastatscript";s.src=g;if(w.opera=="[object Opera]") {d.addEventListener("DOMContentLoaded",f,false);} else {f();}})(document,window,'b3e5db9cfc6c4460a026f51ee207b27b','script','js/tilda-stat-1.0.min.js');},2000);</script>

<!-- Роутер для локальных файлов -->
<script>
(function() {
  const routes = {
    '/': 'index.html',
    '/services': 'page103809416.html',
    '/experts': 'page103811056.html',
    '/cases': 'page103811306.html',
    '/how': 'page103811576.html',
    '/faq': 'page103811816.html',
    '/gallery': 'gallery.html',
    '/projects': 'projects.html',
    '/client-cabinet': 'client-cabinet.html',
    '/create-project': 'create-project.html',
    '/project-detail': 'project-detail.html',
    '/apply': 'apply.html',
    '/add': 'add.html',
    '/auth': 'auth.html',
    '/privacy': 'page103812116.html',
    '/terms': 'page103812316.html',
    '/card': 'page104196026.html',
    '/video': 'page103813046.html',
    '/expert-template': 'page103813286.html',
    '/case-template': 'page103813646.html',
    '/bots': 'page103813746.html',
    '/design': 'page103813896.html',
    '/marketplaces': 'page103814106.html',
    '/sites': 'page103814276.html'
  };
  
  // Глобальная функция роутинга для использования в скриптах
  window.navigateTo = function(href) {
    if (!href) return;
    if (href.startsWith('/') && !href.startsWith('//')) {
      const path = href.split('?')[0].split('#')[0].replace(/\/$/, '') || '/';
      const file = routes[path];
      if (file) {
        const query = href.includes('?') ? href.substring(href.indexOf('?')) : '';
        const hash = href.includes('#') ? href.substring(href.indexOf('#')) : '';
        window.location.href = file + query + hash;
      } else {
        window.location.href = href;
      }
    } else {
      window.location.href = href;
    }
  };
  
  function handleLinkClick(e) {
    const link = e.target.closest('a');
    if (!link) return;
    const href = link.getAttribute('href');
    if (!href) return;
    if (href.startsWith('/') && !href.startsWith('//')) {
      e.preventDefault();
      e.stopPropagation();
      window.navigateTo(href);
    }
  }
  document.addEventListener('click', handleLinkClick, true);
})();
</script>

<!-- Модальное окно для результатов умного поиска -->
<div id="searchModal" class="search-modal" style="display:none;">
  <div class="search-modal-overlay"></div>
  <div class="search-modal-content">
    <button class="search-modal-close" id="closeSearchModal">&times;</button>
    <div class="h-card">
      <div class="h-eyebrow">🔍 Умный поиск</div>
      <h2 class="h-title" style="font-size:28px" id="searchModalTitle">Ищем исполнителей...</h2>
      <p class="h-sub" id="searchModalQuery"></p>
      
      <div id="searchLoading" style="text-align:center;padding:40px 0;">
        <div class="search-spinner"></div>
        <p style="margin-top:16px;color:var(--muted)">Анализируем базу данных...</p>
      </div>
      
      <div id="searchResults" style="display:none;"></div>
      
      <div id="searchEmpty" style="display:none;text-align:center;padding:40px 0;">
        <div style="font-size:48px;margin-bottom:16px;">🤷</div>
        <h3 style="margin:0 0 8px;font-weight:700;">Ничего не найдено</h3>
        <p class="section-sub">Попробуй изменить запрос или посмотри всех исполнителей</p>
        <button class="btn primary" style="margin-top:16px;" onclick="window.closeSearchModal();">Показать всех</button>
      </div>
    </div>
  </div>
</div>

<style>
.search-modal {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  z-index: 9999;
  display: flex;
  align-items: flex-start;
  justify-content: center;
  padding: 40px 20px;
  overflow-y: auto;
}
.search-modal-overlay {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(19, 35, 63, 0.8);
  backdrop-filter: blur(10px);
  animation: fadeIn 0.3s ease;
}
.search-modal-content {
  position: relative;
  z-index: 1;
  max-width: 800px;
  width: 100%;
  animation: slideUp 0.3s ease;
}
.search-modal-close {
  position: absolute;
  top: -10px; right: -10px;
  width: 44px; height: 44px;
  border-radius: 50%;
  background: var(--accent-grad);
  color: white;
  border: none;
  font-size: 28px;
  line-height: 1;
  cursor: pointer;
  box-shadow: 8px 8px 18px rgba(163,177,198,.45), -8px -8px 18px rgba(255,255,255,.85);
  transition: transform 0.2s ease;
  z-index: 2;
}
.search-modal-close:hover { transform: scale(1.1) rotate(90deg); }

.search-spinner {
  width: 48px; height: 48px;
  border: 4px solid rgba(30,120,255,.15);
  border-top-color: var(--accent1);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto;
}
@keyframes spin { to { transform: rotate(360deg); } }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
@keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

.search-result-card {
  background: linear-gradient(145deg, #F8FBFF, #E7EDF7);
  border: 1px solid rgba(255,255,255,.65);
  border-radius: 18px;
  padding: 16px;
  margin-bottom: 14px;
  box-shadow: 10px 10px 22px rgba(163,177,198,.35), -10px -10px 22px rgba(255,255,255,.9);
  transition: .25s all ease;
  cursor: pointer;
}
.search-result-card:hover:not(.expanded) {
  transform: translateY(-2px);
  box-shadow: 14px 14px 28px rgba(163,177,198,.40), -14px -14px 28px rgba(255,255,255,.94);
}
.search-result-card.expanded { cursor: default; border: 2px solid var(--accent1); box-shadow: 0 8px 32px rgba(30,120,255,.18); }
.search-result-card .expand-toggle { display: inline-flex; align-items: center; justify-content: center; gap: 8px; font-size: 13px; color: #fff; font-weight: 700; margin-top: 12px; padding: 10px 20px; background: var(--accent-grad); border-radius: 10px; cursor: pointer; transition: all .2s ease; box-shadow: 0 4px 12px rgba(30,120,255,.25); }
.search-result-card .expand-toggle:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(30,120,255,.35); }
.search-result-card .expand-toggle::after { content: '▼'; font-size: 11px; transition: transform .2s; }
.search-result-card.expanded .expand-toggle { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
.search-result-card.expanded .expand-toggle::after { transform: rotate(180deg); }
.search-result-details { display: none; margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(30,120,255,.12); animation: slideDown .3s ease; }
.search-result-card.expanded .search-result-details { display: block; }
@keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
.search-detail-description { font-size: 14px; line-height: 1.6; color: var(--text); margin-bottom: 16px; }
.search-detail-gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; margin-bottom: 16px; }
.search-detail-gallery-item { aspect-ratio: 1; border-radius: 12px; overflow: hidden; background: linear-gradient(135deg, rgba(30,120,255,.08), rgba(0,183,255,.06)); cursor: pointer; transition: transform .2s; }
.search-detail-gallery-item:hover { transform: scale(1.03); }
.search-detail-gallery-item img, .search-detail-gallery-item video { width: 100%; height: 100%; object-fit: cover; }
.search-detail-albums { margin-bottom: 16px; }
.search-detail-albums-title { font-size: 13px; font-weight: 700; color: var(--muted); margin-bottom: 8px; }
.search-detail-album { display: inline-block; padding: 6px 12px; margin: 0 6px 6px 0; background: rgba(30,120,255,.08); border-radius: 8px; font-size: 13px; font-weight: 600; color: var(--accent1); }
.search-detail-meta { display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 16px; }
.search-detail-meta-item { display: flex; align-items: center; gap: 6px; font-size: 13px; color: var(--muted); }
.search-detail-meta-item strong { color: var(--text); }
.search-detail-actions { display: flex; gap: 12px; flex-wrap: wrap; padding-top: 12px; border-top: 1px solid rgba(30,120,255,.08); }
.search-detail-actions .btn { padding: 12px 20px; font-size: 14px; }
.search-detail-loading { text-align: center; padding: 20px; color: var(--muted); }
.search-detail-loading .mini-spinner { width: 24px; height: 24px; border: 3px solid rgba(30,120,255,.15); border-top-color: var(--accent1); border-radius: 50%; animation: spin .8s linear infinite; margin: 0 auto 8px; }
.search-collapse-btn { display: block; width: 100%; text-align: center; padding: 10px; margin-top: 12px; font-size: 13px; font-weight: 600; color: var(--muted); cursor: pointer; border-radius: 8px; transition: background .15s; }
.search-collapse-btn:hover { background: rgba(30,120,255,.06); color: var(--accent1); }

.search-result-header { display: flex; align-items: flex-start; gap: 14px; }
.search-result-cover {
  width: 100px; height: 70px;
  border-radius: 12px;
  overflow: hidden;
  background: linear-gradient(135deg, rgba(30,120,255,.12), rgba(0,183,255,.10));
  flex-shrink: 0;
}
.search-result-cover img, .search-result-cover video { width: 100%; height: 100%; object-fit: cover; }
.search-result-cover .placeholder { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: var(--muted); font-size: 24px; }
.search-result-info { flex: 1; min-width: 0; }
.search-result-name { font-weight: 900; font-size: 17px; margin: 0 0 4px; display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
.search-result-category { font-size: 12px; color: var(--muted); font-weight: 600; }
.search-result-relevance { font-size: 12px; font-weight: 700; padding: 3px 8px; border-radius: 8px; background: var(--accent-grad); color: #fff; }
.search-result-short { color: var(--muted); font-size: 14px; line-height: 1.4; margin: 6px 0; }
.search-result-matches { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 10px; }
.search-match-tag { font-size: 11px; padding: 4px 10px; border-radius: 999px; background: rgba(30,120,255,.12); color: var(--accent1); font-weight: 600; }
.search-result-actions { display: flex; gap: 10px; margin-top: 12px; flex-wrap: wrap; }
.search-result-actions .btn { padding: 8px 14px; font-size: 13px; }

@media (max-width: 600px) {
  .search-result-header { flex-direction: column; }
  .search-result-cover { width: 100%; height: 120px; }
  .search-modal { padding: 20px 12px; }
}
</style>

<script>
(function() {
  const BUCKET = "experts-media";
  const CARD_PATH = "/card";
  const CAT_LABELS = { video: "AI-Видео", design: "AI-Дизайн", bots: "AI-Боты", marketplaces: "WB/Ozon", sites: "AI-Сайты" };
  
  const modal = document.getElementById('searchModal');
  const closeBtn = document.getElementById('closeSearchModal');
  const overlay = modal ? modal.querySelector('.search-modal-overlay') : null;
  const titleEl = document.getElementById('searchModalTitle');
  const queryEl = document.getElementById('searchModalQuery');
  const loadingEl = document.getElementById('searchLoading');
  const resultsEl = document.getElementById('searchResults');
  const emptyEl = document.getElementById('searchEmpty');
  
  function openSearchModal(query) {
    if (!modal) return;
    modal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
    titleEl.textContent = 'Ищем исполнителей...';
    queryEl.textContent = 'Запрос: «' + query + '»';
    loadingEl.style.display = '';
    resultsEl.style.display = 'none';
    emptyEl.style.display = 'none';
    resultsEl.innerHTML = '';
    performSearch(query);
  }
  
  function closeSearchModal() {
    if (!modal) return;
    modal.style.display = 'none';
    document.body.style.overflow = '';
  }
  
  window.openSearchModal = openSearchModal;
  window.closeSearchModal = closeSearchModal;
  
  // Функция раскрытия/сворачивания карточки
  window.toggleExpertCard = async function(cardEl) {
    if (!cardEl) return;
    const isExpanded = cardEl.classList.contains('expanded');
    if (isExpanded) { cardEl.classList.remove('expanded'); return; }
    document.querySelectorAll('.search-result-card.expanded').forEach(c => c.classList.remove('expanded'));
    cardEl.classList.add('expanded');
    const detailsEl = cardEl.querySelector('.search-result-details');
    if (detailsEl && detailsEl.dataset.loaded === 'false') await loadExpertDetails(cardEl);
    setTimeout(() => cardEl.scrollIntoView({ behavior: 'smooth', block: 'start' }), 100);
  };
  
  async function loadExpertDetails(cardEl) {
    const expertId = cardEl.dataset.expertId;
    const detailsEl = cardEl.querySelector('.search-result-details');
    const actionsEl = cardEl.querySelector('.search-result-actions');
    if (!expertId || !detailsEl) return;
    const sb = await waitSbForSearch();
    if (!sb) { detailsEl.innerHTML = '<div class="search-detail-loading">Ошибка загрузки</div>'; return; }
    try {
      const [expertRes, albumsRes, mediaRes] = await Promise.all([
        sb.from('experts').select('*').eq('id', expertId).single(),
        sb.from('expert_albums').select('*').eq('expert_id', expertId).order('created_at', { ascending: false }),
        sb.from('expert_media').select('*').eq('expert_id', expertId).order('created_at', { ascending: false }).limit(12)
      ]);
      const expert = expertRes.data, albums = albumsRes.data || [], mediaItems = mediaRes.data || [];
      if (!expert) { detailsEl.innerHTML = '<div class="search-detail-loading">Данные не найдены</div>'; return; }
      const mediaPaths = mediaItems.map(m => m.path).filter(Boolean), mediaUrlByPath = {};
      if (mediaPaths.length > 0) {
        const { data: signedData } = await sb.storage.from(BUCKET).createSignedUrls(mediaPaths, 3600);
        (signedData || []).forEach(item => { if (item?.path && item?.signedUrl) mediaUrlByPath[item.path] = item.signedUrl; });
      }
      let html = '';
      if (expert.description) html += '<div class="search-detail-description">' + esc(expert.description) + '</div>';
      html += '<div class="search-detail-meta">';
      if (expert.price_from) html += '<div class="search-detail-meta-item">💰 <strong>' + esc(expert.price_from) + '</strong></div>';
      if (expert.delivery_time) html += '<div class="search-detail-meta-item">⏱ <strong>' + esc(expert.delivery_time) + '</strong></div>';
      html += '</div>';
      if (albums.length > 0) {
        html += '<div class="search-detail-albums"><div class="search-detail-albums-title">📁 Альбомы:</div>';
        albums.forEach(album => html += '<span class="search-detail-album">' + esc(album.title) + '</span>');
        html += '</div>';
      }
      if (mediaItems.length > 0) {
        html += '<div class="search-detail-gallery">';
        mediaItems.slice(0, 8).forEach(media => {
          const mediaUrl = media.path ? (mediaUrlByPath[media.path] || '') : '';
          if (mediaUrl) {
            const isVideo = String(media.type || '').toLowerCase() === 'video';
            html += isVideo 
              ? '<div class="search-detail-gallery-item"><video src="' + escA(mediaUrl) + '" muted preload="metadata"></video></div>'
              : '<div class="search-detail-gallery-item"><img src="' + escA(mediaUrl) + '" alt=""></div>';
          }
        });
        html += '</div>';
      }
      html += '<div class="search-collapse-btn" onclick="window.toggleExpertCard(this.closest(\'.search-result-card\'))">▲ Свернуть</div>';
      detailsEl.innerHTML = html;
      detailsEl.dataset.loaded = 'true';
      const tgLink = buildTgLink(expert.telegram), profileHref = CARD_PATH + '?id=' + encodeURIComponent(expertId);
      let actionsHtml = '<a class="btn primary" href="' + escA(profileHref) + '">Полный профиль →</a>';
      if (tgLink) actionsHtml += '<a class="btn" href="' + escA(tgLink) + '" target="_blank" rel="noopener">💬 Написать в Telegram</a>';
      actionsEl.innerHTML = actionsHtml;
    } catch (err) { console.error('Ошибка загрузки деталей:', err); detailsEl.innerHTML = '<div class="search-detail-loading">Ошибка загрузки данных</div>'; }
  }
  
  if (closeBtn) closeBtn.addEventListener('click', closeSearchModal);
  if (overlay) overlay.addEventListener('click', closeSearchModal);
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && modal && modal.style.display === 'flex') closeSearchModal();
  });
  
  // Ждём Supabase
  async function waitSbForSearch() {
    for (let i = 0; i < 60; i++) {
      if (window.AI_BIRZHA && window.AI_BIRZHA.sb) return window.AI_BIRZHA.sb;
      await new Promise(r => setTimeout(r, 100));
    }
    return null;
  }
  
  async function performSearch(query) {
    const sb = await waitSbForSearch();
    if (!sb) { loadingEl.style.display = 'none'; emptyEl.style.display = ''; console.error('Supabase не подключен'); return; }
    
    try {
      const { data, error } = await sb.rpc('search_experts', { query_text: query });
      
      if (error || !data || data.length === 0) {
        loadingEl.style.display = 'none';
        emptyEl.style.display = '';
        titleEl.textContent = 'Ничего не найдено';
        return;
      }
      
      const paths = data.map(x => x.cover_path).filter(Boolean);
      const urlByPath = {};
      if (paths.length > 0) {
        const { data: signedData } = await sb.storage.from(BUCKET).createSignedUrls(paths, 3600);
        (signedData || []).forEach(item => { if (item?.path && item?.signedUrl) urlByPath[item.path] = item.signedUrl; });
      }
      
      loadingEl.style.display = 'none';
      resultsEl.style.display = '';
      titleEl.textContent = 'Найдено: ' + data.length + ' исполнител' + getWordEnding(data.length);
      
      resultsEl.innerHTML = data.map(expert => {
        const coverUrl = expert.cover_path ? (urlByPath[expert.cover_path] || '') : '';
        const coverType = String(expert.cover_type || '').toLowerCase();
        const expertId = expert.id;
        const relevancePercent = Math.min(100, Math.round(expert.relevance));
        const catLabel = CAT_LABELS[expert.category] || expert.category;
        
        const matchesHtml = (expert.matched_in || []).filter(m => m).slice(0, 4)
          .map(m => '<span class="search-match-tag">✓ ' + esc(m) + '</span>').join('');
        
        let coverHtml = coverUrl 
          ? (coverType === 'video' ? '<video src="' + escA(coverUrl) + '" muted preload="metadata"></video>' : '<img src="' + escA(coverUrl) + '" alt="">')
          : '<div class="placeholder">👤</div>';
        
        const tgLink = buildTgLink(expert.telegram);
        const tgBtnHtml = tgLink ? '<a class="btn tg-link" href="' + escA(tgLink) + '" target="_blank" rel="noopener">💬 Написать</a>' : '';
        
        return `
          <div class="search-result-card" data-expert-id="${escA(expertId)}">
            <div class="search-result-header">
              <div class="search-result-cover">${coverHtml}</div>
              <div class="search-result-info">
                <h3 class="search-result-name">${esc(expert.name)} <span class="search-result-relevance">${relevancePercent}%</span></h3>
                <div class="search-result-category">${esc(catLabel)} • ${esc(expert.role || '')}</div>
                <p class="search-result-short">${esc(expert.short_info || '—')}</p>
              </div>
            </div>
            ${matchesHtml ? '<div class="search-result-matches">' + matchesHtml + '</div>' : ''}
            <div class="expand-toggle">Подробнее</div>
            <div class="search-result-details" data-loaded="false">
              <div class="search-detail-loading"><div class="mini-spinner"></div><div>Загружаем портфолио...</div></div>
            </div>
            <div class="search-result-actions">${tgBtnHtml}</div>
          </div>
        `;
      }).join('');
      
      // Добавляем обработчики событий
      resultsEl.querySelectorAll('.search-result-card').forEach(card => {
        card.addEventListener('click', function(e) {
          if (e.target.closest('a, button')) return;
          window.toggleExpertCard(card);
        });
      });
    } catch (err) {
      console.error('Ошибка поиска:', err);
      loadingEl.style.display = 'none';
      emptyEl.style.display = '';
    }
  }
  
  function esc(s) { return String(s || '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m])); }
  function escA(s) { return esc(s).replace(/"/g, '&quot;'); }
  function buildTgLink(raw) { if(!raw) return null; const t=raw.trim(); if(!t) return null; if(t.startsWith('@')) return 'https://t.me/'+t.slice(1); if(t.includes('t.me/')) return t; return 'https://t.me/'+t; }
  function getWordEnding(c) { const l2=c%100,l1=c%10; if(l2>=11&&l2<=14)return'ей'; if(l1===1)return'ь'; if(l1>=2&&l1<=4)return'я'; return'ей'; }
  
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('form[data-search]').forEach(function(form) {
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        const input = form.querySelector('input[name="q"]');
        const query = input ? input.value.trim() : '';
        if (!query) { alert('Введите запрос для поиска'); return; }
        openSearchModal(query);
      });
    });
  });
})();
</script>

<script src="/js/mobile-menu.js?v=20260104c1"></script>
</body> </html>